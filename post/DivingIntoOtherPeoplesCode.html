<html><head><meta charset="utf-8" /><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" type="text/css" /><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" /><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/github-gist.min.css" rel="stylesheet" type="text/css" /><title>Diving Into Other People's Code</title><style>@media (min-width: 60em) {.ammonite-scripts-pageStyles_3-WideStyles-header{
  bottom: 0px;
  justify-content: center;
  position: fixed;
  top: 0px;
  width: 25%;
}

.ammonite-scripts-pageStyles_3-WideStyles-headerContent{
  text-align: center;
}

.ammonite-scripts-pageStyles_3-WideStyles-content{
  box-sizing: border-box;
  margin-left: 25%;
  padding: 48px;
}

.ammonite-scripts-pageStyles_3-WideStyles-footer{
  bottom: 0px;
  height: 50px;
  position: fixed;
  width: 25%;
}
}</style><style>@media (max-width: 60em) {.ammonite-scripts-pageStyles_3-NarrowStyles-header{
  margin-bottom: 10px;
}

.ammonite-scripts-pageStyles_3-NarrowStyles-content{
  padding: 16px;
}

.ammonite-scripts-pageStyles_3-NarrowStyles-headerContent{
  display: flex;
  flex-direction: row;
  width: 100%;
}

.ammonite-scripts-pageStyles_3-NarrowStyles-linkFlex{
  align-self: flex-end;
}

.ammonite-scripts-pageStyles_3-NarrowStyles-flexFont{
  font-size: 4vw;
}
}</style><style>.ammonite-scripts-pageStyles_3-Styles-header{
  align-items: center;
  background-color: rgb(61, 79, 93);
  box-sizing: border-box;
  display: flex;
}

.ammonite-scripts-pageStyles_3-Styles-headerLinkBox{
  display: flex;
  flex: 1;
  flex-direction: column;
  text-align: center;
}

.ammonite-scripts-pageStyles_3-Styles-headerLink{
  align-items: center;
  display: flex;
  flex: 1;
  justify-content: center;
  padding: 10px 10px;
}

.ammonite-scripts-pageStyles_3-Styles-footer{
  color: rgb(158, 167, 174);
  display: flex;
  justify-content: center;
}

.ammonite-scripts-pageStyles_3-Styles-subtleLink{
  text-decoration: none;
}
</style><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/languages/scala.min.js"></script><script>hljs.initHighlightingOnLoad();</script><meta name="viewport" content="initial-scale = 1.0,maximum-scale = 1.0" /><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-27464920-5', 'auto');
ga('send', 'pageview');
</script><script>if (window.location.protocol == "https:")
    window.location.href = "http:" + window.location.href.substring(window.location.protocol.length);
</script></head><body style="margin: 0px;"><div class=" ammonite-scripts-pageStyles_3-WideStyles-header ammonite-scripts-pageStyles_3-NarrowStyles-header ammonite-scripts-pageStyles_3-Styles-header"><div class=" ammonite-scripts-pageStyles_3-NarrowStyles-headerContent ammonite-scripts-pageStyles_3-WideStyles-headerContent"><h1 style="padding: 30px 30px;margin: 0px;"><a style="color: white;font-weight: bold;" href=".." class=" ammonite-scripts-pageStyles_3-Styles-subtleLink ammonite-scripts-pageStyles_3-NarrowStyles-flexFont"><i class="fa fa-cogs"></i> Haoyi's Programming Blog</a></h1><div class=" ammonite-scripts-pageStyles_3-Styles-headerLinkBox ammonite-scripts-pageStyles_3-NarrowStyles-linkFlex" style="min-width: 175px;"><div style="display: flex;flex-direction: row;"><div class=" ammonite-scripts-pageStyles_3-Styles-headerLink"><a href="../post/HelloWorldBlog.html" class=" ammonite-scripts-pageStyles_3-Styles-subtleLink" style="color: white;"><div><div><i class="fa fa-question-circle"></i></div> About</div></a></div><div class=" ammonite-scripts-pageStyles_3-Styles-headerLink"><a href="https://lihaoyi.github.io/Resume/" class=" ammonite-scripts-pageStyles_3-Styles-subtleLink" style="color: white;"><div><div><i class="fa fa-file-text"></i></div> Resume</div></a></div><div class=" ammonite-scripts-pageStyles_3-Styles-headerLink"><a href="https://github.com/lihaoyi" class=" ammonite-scripts-pageStyles_3-Styles-subtleLink" style="color: white;"><div><div><i class="fa fa-github"></i></div> Github</div></a></div></div><div style="display: flex;flex-direction: row;"><div class=" ammonite-scripts-pageStyles_3-Styles-headerLink"><a href="https://twitter.com/li_haoyi" class=" ammonite-scripts-pageStyles_3-Styles-subtleLink" style="color: white;"><div><div><i class="fa fa-twitter"></i></div> Twitter</div></a></div><div class=" ammonite-scripts-pageStyles_3-Styles-headerLink"><a href="../feed.xml" class=" ammonite-scripts-pageStyles_3-Styles-subtleLink" style="color: white;"><div><div><i class="fa fa-rss"></i></div>RSS</div></a></div><div class=" ammonite-scripts-pageStyles_3-Styles-headerLink"><a href="../post/TalksIveGiven.html" class=" ammonite-scripts-pageStyles_3-Styles-subtleLink" style="color: white;"><div><div><i class="fa fa-youtube-play"></i></div> Talks</div></a></div></div></div></div></div><div class=" ammonite-scripts-pageStyles_3-WideStyles-content ammonite-scripts-pageStyles_3-NarrowStyles-content" style="max-width: 900px;"><h1>Diving Into Other People's Code</h1><div style="color: #999;margin-bottom: 20px;">Posted <a href="https://github.com/lihaoyi/blog/commit/cc42e0f9be957ceffd2e88ea77d98d8be805d752">2016-03-15</a></div><p>This post will walk you through an exercise in diving into someone else's code. The goal will be to make an arbitrary change to the code of the <a href="https://github.com/spyder-ide/spyder#spyder---the-scientific-python-development-environment">Spyder Python IDE</a>, a project I have never touched before in my life, and learn <em>just</em> enough about it to accomplish what I want without getting bogged down. You will learn how to approach problems without the rigour taught in formal education, and instead with guesswork, experimentation, and insight learned in a professional environment. You will see first-hand the joys, sorrows and frustrations trying to navigate the project, culminating in a working (if rough) patch adding a feature to a large, unfamiliar codebase.</p>
<p>Everyone who learns programming has written a pile of code in a bunch of different programs: whether it's implementing algorithms for problem sets, building websites, or making video games. Being a professional software engineer, on the other hand, very often does <em>not</em> involve <em>"writing lots of code"</em>! More often, you spend your time spelunking deep into other peoples code: code you do not understand, did not write, and have possibly never seen before in your life. You have no-one to ask for help, no-one to hear you scream, and yet you have to make forward progress.</p>
<hr/><h2 id="goal">Goal</h2>
<p>The goal of this post is to dive into a codebase we've never seen before and make some non-trivial changes to it. The target of this exercise is going to be the <a href="https://github.com/spyder-ide/spyder#spyder---the-scientific-python-development-environment">Spyder Python IDE</a>. According to the Github page, it looks something like:</p>
<p><div style="text-align: center"><img src="Diving/Spyder.png" alt="Diving/Spyder.png" style="max-width: 100%; max-height: 500px" /></div></p>
<p>Our (arbitrary) goal is going to add a new dropdown menu next to the <code>Help</code> dropdown called <code>Misc</code>, and inside there is going to be a menu-item/command that takes the currently opened text area and prepends the code:</p>
<pre><code class="python">print(&quot;Running %s&quot; % __name__)
</code></pre>
<p>At the top to indicate when a file starts executing.</p>
<p>I have worked with Python and Javascript professionally for several years now, and am deeply familiar with the ecosystems around both. I'm also experienced working in Linux environments, with the Bash command-line, and have done a lot of open-source Scala as well as some Java/C#/PHP in the ancient past. Nevertheless, I have never used the Spyder editor or touched its codebase in any way, nor have I ever really seen it before today. This exercise will explore how you attack such a codebase from a position of total ignorance and make progress despite your continued partial ignorance.</p><h2 id="strategy">Strategy</h2>
<p>Here's the order of business approaching an unknown codebase like this:</p>
<ul>
  <li><a href="#exposure">Exposure</a>: browse the docs to get a high-level overview of what  the project is/does</li>
  <li><a href="#installation">Installation</a>: get the project running locally, no matter  what it takes
    <ul>
      <li><a href="#anaconda">Anaconda</a></li>
      <li><a href="#back-to-spyder">Back to Spyder</a></li>
      <li><a href="#pyqt5-to-pyside">PyQt5 to PySide</a></li>
      <li><a href="#back-to-pyqt5">Back to PyQt5</a></li>
    </ul>
  </li>
  <li><a href="#Familiarization">Familiarization</a>: leaf through the codebase at-large to  see roughly what's where
    <ul>
      <li><a href="#touring-the-code">Touring the Code</a></li>
      <li><a href="#spyderlib">Spyderlib</a></li>
    </ul>
  </li>
  <li><a href="#hello-world">Hello World</a>: tweak something small and make sure it affects  the running code</li>
  <li><a href="#iteration">Iteration</a>: keep fiddling with the code to get more and more stuff working
    <ul>
      <li><a href="#rolling-in-mud">Rolling in Mud</a></li>
      <li><a href="#our-own-action">Our own Action</a></li>
      <li><a href="#endgame-the-editor">Endgame: the Editor</a></li>
    </ul>
  </li>
  <li><a href="#conclusion">Conclusion</a></li>
</ul>
<p>When working with Other People's Code, there are several things to keep in mind:</p>
<ul>
  <li>
  <p>You have to know what the project does. In this case it seems to be some  sort of graphical IDE for scientific <a href="https://www.python.org/">Python</a>, which  is great: I know what an IDE is, and what Python is, even though I've never  used <em>scientific</em> Python. If it's another project with more specialized  usage, make sure you know what it's <em>meant</em> to do before diving in.</p></li>
  <li>
  <p>The code probably works. If the project is abandoned, or hasn't seen activity  in a while, it might not, but Spyder had its last commit  <a href="https://github.com/spyder-ide/spyder/commit/3f4b5121f99f6aec1e70dba4151e07ea311cda27">two days ago</a>  so you can be reasonably sure someone is working on it and it's working  enough for them to make changes</p></li>
  <li>
  <p>There has to be <em>some</em> way of setting it up for "development": making code  changes and seeing them work, or not. This is probably distinct from the  "bundle everything up for distribution" mode.</p></li>
  <li>
  <p>It <em>has to be possible</em>* to set it up. If the project is old, abandoned or  built by a single person this might not be true, as it might require special  preparation that only existed on the original developer's laptop. This one  on the other hand seems actively developed by multiple people, so even if  setup proves to be a pain in the neck, we at least know it's <em>possible</em>.</p></li>
  <li>
  <p>It's ok if it takes time to get set up. "Several days" to get set up isn't  uncommon in professional settings which have sprawling messes of code, even  if it is a bit long. "A few hours" is probably reasonable: my first  installation of <a href="https://en.wikipedia.org/wiki/PHP">PHP</a> +  <a href="https://www.mysql.com/">MySQL</a> took 9 hours. Ideally you'd  be able to get set up with a development environent in seconds, like you  can with the <a href="https://github.com/ipython/ipython">IPython</a> project, but  not every project lucky enough to be so self-contained and dependency-free.</p></li>
</ul><h2 id="exposure">Exposure</h2>
<p>If you have no idea what a project is or does, you have no hope of trying to make changes to it. In this case, we are looking at the <a href="https://github.com/spyder-ide/spyder#spyder---the-scientific-python-development-environment">Spyder Python IDE</a>:</p>
<p><div style="text-align: center"><img src="Diving/Spyder.png" alt="Diving/Spyder.png" style="max-width: 100%; max-height: 500px" /></div></p>
<p>This is a Python IDE that is written <em>for</em> Python, <em>in</em> Python, as can be seen from the breakdown on the github page:</p>
<p><div style="text-align: center"><img src="Diving/SpyderLang.png" alt="Diving/Spyder.png" style="max-width: 100%; max-height: 500px" /></div></p>
<p>At first glance, it has a code editor on the left, a <a href="https://github.com/ipython/ipython">IPython REPL</a> in the bottom right (you can tell rom the tell-tale <code>In [1]</code> syntax) which supports graphical output similar to IPython's <a href="http://ipython.org/notebook.html">Notebooks</a>, and a documentation browser in the top-right. Otherwise it looks like a pretty typical IDE: buttons at the top to save/load/copy/run/debug/step-through your code, with drop-down menus holding lots more functionality, a tabbed text editor with syntax highlighting and other things.</p>
<p>Spyder seems to run on basically any platform: the docs include instructions for <a href="http://pythonhosted.org/spyder/installation.html#installing-on-windows-vista-7-8-10">basically all version of Windows</a>, <a href="http://pythonhosted.org/spyder/installation.html#installing-on-macos-x">Mac OS-X</a>, and <a href="http://pythonhosted.org/spyder/installation.html#installing-on-linux">Linux</a> (Ubuntu, Debian, Arch, Fedora, ...)</p>
<p>It seems like a reasonably old (several years), reasonably active project with a good number of contributors:</p>
<p><div style="text-align: center"><img src="Diving/Contributors.png" alt="Diving/Contributors.png" style="max-width: 100%; max-height: 500px" /></div></p>
<p>So it's not just a one-man fly-by-night show. It's not entirely clear whether there's a commercial entity backing it or not.</p>
<p>That's a quick overview of what Spyder appears to be to an un-initiated outsider. Let's try to get Spyder working on our Macbook!</p><h2 id="installation">Installation</h2>
<p>The first thing you want to do when you decide you want to try out a project is figure out how you can install it in "development mode": usually projects will have a nice, all-included, encapsulated distribution that is convenient to download for end-users working <em>within</em> that project, but not the same as what a person working <em>on</em> that project would want to use. In the case of Spyder, this appears to be the distinction between the two sections:</p>
<ul>
  <li><a href="https://github.com/spyder-ide/spyder#installation">Installation</a></li>
  <li><a href="https://github.com/spyder-ide/spyder#running-from-source">Running from Source</a></li>
</ul>
<p>If I was an end-user who just wanted an IDE, I would use the <strong>Installation</strong> instructions. But since I'm interested in modifying Spyder rather than just using it, I will start with <strong>Running from Source</strong>. This is always harder, less convenient and more time-consuming than using the "packaged" distribution. Nonetheless, if you are at all interested in making changes to the code, you will need to get over this hump eventually so might as well get over it now.</p>
<p>As is common, the first thing you need to do is download dependencies. Spyder is not developed in a vacuum, and under the section on <a href="https://github.com/spyder-ide/spyder#dependencies">Dependencies</a> we see:</p>
<blockquote>
  <ul>
    <li><strong>Python</strong> 2.7 or 3.3+</li>
    <li><strong>PyQt5</strong> 5.2+ or <strong>PyQt4</strong> 4.6+: PyQt5 is recommended.</li>
    <li><strong>qtconsole</strong>: Enhanced Python interpreter.</li>
    <li><strong>Rope</strong> and <strong>Jedi</strong>: Editor code completion, calltips and go-to-definition.</li>
    <li><strong>Pyflakes</strong>: Real-time code analysis.</li>
    <li><strong>Sphinx</strong>: Rich text mode for the Help pane.</li>
    <li><strong>Pygments</strong>: Syntax highlighting for all file types it supports.</li>
    <li><strong>Pylint</strong>: Static code analysis.</li>
    <li><strong>Pep8</strong>: Style analysis.</li>
    <li><strong>Psutil</strong>: CPU and memory usage on the status bar.</li>
    <li><strong>Nbconvert</strong>: Manipulation of notebooks in the Editor.</li>
    <li><strong>Qtawesome</strong>: To have an icon theme based on FontAwesome.</li>
    <li><strong>Pickleshare</strong>: Show import completions on the Python consoles.</li>
    <li><strong>PyZMQ</strong>: Run introspection services asynchronously.</li>
  </ul>
</blockquote>
<p>That's quite a long list! I know what Python is, but I have no idea what the rest of these things seem to be. In principle, I could go and install each of these dependencies one by one using <a href="http://python-packaging-user-guide.readthedocs.org/en/latest/installing/">pip</a>, Python's package manager, but I also notice at the top of the <strong>Dependencies</strong> section is a little disclaimer:</p>
<ul>
  <li><strong>Important</strong> note: Most if not all the dependencies listed below come with  Anaconda, WinPython and Python(x,y), so you don't need to install them  separately when installing one of these Scientific Python distributions.</li>
</ul>
<p>It seems there's a single bundle I can download to install it all! I've never used any of these "Scientific Python Distributions" before, but I've heard of them: they're a pre-packaged Python download that comes complete with a bunch of useful libraries included. In this case, Spyder is telling us that any of these pre-packaged downloads should have everything we need. Thus, the next step in our quest is to go and download one of them to try out, starting with Anaconda </p><h3 id="anaconda">Anaconda</h3>
<p>I'm on a Macbook Pro running OS-X, and Googling "Anaconda OS-X" takes me right to the download page:</p>
<p><div style="text-align: center"><img src="Diving/GoogleAnaconda.png" alt="Diving/GoogleAnaconda.png" style="max-width: 100%; max-height: 500px" /></div></p>
<p>The installation page seems to start off with <strong>Get Superpowers with Anaconda</strong> which seems totally meaningless to me, so let's ignore that. There's also an <strong>OS-X</strong> link, so let's follow that, which brings us to the installer download:</p>
<p><div style="text-align: center"><img src="Diving/AnacondaInstall.png" alt="Diving/AnacondaInstall.png" style="max-width: 100%; max-height: 500px" /></div></p>
<p>For now, I'm going to go with the command-line download for Python 3.5 instead of Python 2.7. Below the download link, there are instructions to get started:</p>
<blockquote>
  <p><strong>Command Line Installer</strong>:</p>
  <ol>
    <li>Download the command line installer.</li>
    <li>In your terminal window, type one of the below and follow the instructions:  <strong>Python</strong> 2.7:  <code>bash Anaconda2-2.5.0-MacOSX-x86_64.sh</code>  <strong>Python</strong> 3.5:  <code>bash Anaconda3-2.5.0-MacOSX-x86_64.sh</code>  NOTE: Include the "bash" command even if you are not using the bash shell.</li>
    <li>Optional: Verify data integrity with MD5.</li>
  </ol>
</blockquote>
<p>Anaconda is a big install (&gt;200mb!) and takes 3-4 minutes to download. Running the installer in the command-line as instructed starts off a several-minute-long download-and-install process:</p>
<pre><code class="python">$ bash ../Downloads/Anaconda3-2.5.0-MacOSX-x86_64.sh

Welcome to Anaconda3 2.5.0 (by Continuum Analytics, Inc.)

In order to continue the installation process, please review the license
agreement.
Please, press ENTER to continue
&gt;&gt;&gt;
================
Anaconda License
================
...
</code></pre>
<p>Which, after entering <code>yes</code> or <code>ENTER</code> to a bunch of questions it asks you, seems to end with:</p>
<pre><code class="python">...
Prepending PATH=/Users/haoyi/anaconda3/bin to PATH in
newly created /Users/haoyi/.bash_profile

For this change to become active, you have to open a new terminal.

Thank you for installing Anaconda3!

Share your notebooks and packages on Anaconda Cloud!
Sign up for free: https://anaconda.org
</code></pre>
<p>It turns out that immediately running <code>anaconda</code> doesn't seem to work, and the <code>python3</code> command is unchanged:</p>
<pre><code class="python">haoyi-mbp:test haoyi$ anaconda
-bash: anaconda: command not found

haoyi-mbp:test haoyi$ python3
Python 3.4.2 (default, Feb 10 2015, 03:38:22)
[GCC 4.2.1 Compatible Apple LLVM 6.0 (clang-600.0.56)] on darwin
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt;
</code></pre>
<p>Which is probably expected, since the install printouts tell us it only works when you open a new terminal. So opening a new terminal and running <code>anaconda</code>, we get:</p>
<pre><code class="">haoyi-mbp:~ haoyi$ anaconda
usage: anaconda [-h] [--show-traceback] [--hide-traceback] [-v] [-q] [--color]
                [--no-color] [-V] [-t TOKEN] [-s SITE]
                ...
anaconda: error: A sub command must be given. To show all available sub commands, run:

	 anaconda -h

</code></pre>
<p>No clue what <em>that</em> is, but I guess we installed something! Running <code>python3</code> now, we get</p>
<pre><code class="">$ python3
Python 3.5.1 |Anaconda 2.5.0 (x86_64)| (default, Dec  7 2015, 11:24:55)
[GCC 4.2.1 (Apple Inc. build 5577)] on darwin
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt;
</code></pre>
<p>With the <code>Anaconda</code> in the introductory banner, it seems we've installed Anaconda successfully! As for the last step "Verify data integrity with MD5", let's just <a href="http://tinyurl.com/htep7tk">YOLO</a> it for now.</p><h3 id="back-to-spyder">Back to Spyder</h3>
<p>Now that Anaconda is sorted out, let's go back to the <a href="https://github.com/spyder-ide/spyder#running-from-source">Running from Source</a> part of the documentation. Directly underneath the header, before all that talk of dependencies, we see</p>
<blockquote>
  <p>The fastest way to run Spyder is to get the source code using git, install PyQt5 or PyQt4, and run these commands:</p>
  <ol>
    <li>Install our runtime dependencies (see below).</li>
    <li><code>cd /your/spyder/git-clone</code></li>
    <li><code>python bootstrap.py</code></li>
  </ol>
  <p>You may want to do this for fixing bugs in Spyder, adding new features, learning how Spyder works or just getting a taste of it.</p>
</blockquote>
<p>I guess it expects us to have cloned the Spyder repository in order to <code>cd</code> into it. Let's do that using the URL listed on the Github page:</p>
<p><div style="text-align: center"><img src="Diving/SpyderCloneUrl.png" alt="Diving/SpyderCloneUrl.png" style="max-width: 100%; max-height: 500px" /></div></p>
<pre><code class="python">$ git clone git@github.com:spyder-ide/spyder.git
Cloning into &#39;spyder&#39;...
remote: Counting objects: 43311, done.
remote: Compressing objects: 100% (393/393), done.
remote: Total 43311 (delta 263), reused 0 (delta 0), pack-reused 42918
Receiving objects: 100% (43311/43311), 28.27 MiB | 3.53 MiB/s, done.
Resolving deltas: 100% (33096/33096), done.
Checking connectivity... done.
</code></pre>
<p>If anyone wants to follow along, the commit at-time-of-writing is</p>
<ul>
  <li><a href="https://github.com/spyder-ide/spyder/commit/df9577cfc279d2b6f2c07c7ba4e8e7aebfdd1835">df9577cfc279d2b6f2c07c7ba4e8e7aebfdd1835</a></li>
</ul>
<p>And then <code>cd</code>ing into it and running it:</p>
<pre><code class="python">$ python3 bootstrap.py
Executing Spyder from source checkout
Revision df9577c, Branch: master
01. Patched sys.path with /Users/haoyi/test/spyder
02. No PyQt5 or PyQt4 detected, using PySide if available (deprecated)
Traceback (most recent call last):
  File &quot;/Users/haoyi/test/spyder/spyderlib/qt/__init__.py&quot;, line 62, in &lt;module&gt;
    from PySide import __version__  # analysis:ignore
ImportError: No module named &#39;PySide&#39;

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File &quot;bootstrap.py&quot;, line 140, in &lt;module&gt;
    versions = get_versions(reporev=False)
  File &quot;/Users/haoyi/test/spyder/spyderlib/__init__.py&quot;, line 65, in get_versions
    import spyderlib.qt
  File &quot;/Users/haoyi/test/spyder/spyderlib/qt/__init__.py&quot;, line 65, in &lt;module&gt;
    raise ImportError(&quot;Spyder requires PyQt5, PyQt4 or PySide (deprecated) &quot;
ImportError: Spyder requires PyQt5, PyQt4 or PySide (deprecated) to be installed
$
</code></pre>
<p>I guess when the docs said "Most if not all the dependencies listed below come with <em>Anaconda</em>..." it was definitely a <em>most</em> and not an <em>all</em>. No matter, let's install PyQt5 (listed on the github readme as "recommended") using <code>pip3</code>, the Python 3 version of <code>pip</code> that should correspond with the <code>python3</code> executable that came with Anaconda:</p><h3 id="pyqt5-to-pyside">PyQt5 to PySide</h3>
<pre><code class="python">$ pip3 install PyQt5
You are using pip version 6.0.8, however version 8.1.0 is available.
You should consider upgrading via the &#39;pip install --upgrade pip&#39; command.
Collecting PyQt5
  Could not find any downloads that satisfy the requirement PyQt5
  No distributions at all found for PyQt5
$
</code></pre>
<p>Nope? Googling for "pip install PyQt5" gives:</p>
<ul>
  <li><a href="http://stackoverflow.com/questions/21577723/why-cant-i-install-pyqt5-from-the-pypi">http://stackoverflow.com/questions/21577723/why-cant-i-install-pyqt5-from-the-pypi</a></li>
</ul>
<p>Which makes it appear like you can't install this library from PyPI using pip. Googling "osx pyqt5" gives:</p>
<ul>
  <li><a href="https://gist.github.com/vityafx/e01ab56d28a2c9467cc6">https://gist.github.com/vityafx/e01ab56d28a2c9467cc6</a></li>
</ul>
<p>It appears there isn't any way to install PyQt5 easily without having to do a whole bunch of manual <code>tar</code>ing and <code>make</code>ing at the command line. On the other hand, the error message earlier said that the <a href="http://pyside.readthedocs.org/en/latest/">PySide</a> module was deprecated, but it might still work! For now, I don't care about deprecation warnings, I just want to get something (*anything*) that works. Googling "pip install pyside" finds a page for that module on the standard module repository:</p>
<ul>
  <li><a href="https://pypi.python.org/pypi/PySide/1.2.4">https://pypi.python.org/pypi/PySide/1.2.4</a></li>
</ul>
<p>Trying to install that using <code>pip3</code> seems to work initially, but then fails with</p>
<pre><code class="python">$ pip3 install PySide
You are using pip version 6.0.8, however version 8.1.0 is available.
You should consider upgrading via the &#39;pip install --upgrade pip&#39; command.
Collecting PySide
  Downloading PySide-1.2.4.tar.gz (9.3MB)
    100% |################################| 9.3MB 69kB/s
    Removing /private/var/folders/xw/4lw_p32d0pg88hyg5rfn7vqxqhkgj_/T/pip-build-8_5xp5w9/PySide/pyside_package
    package init file &#39;pyside_package/PySide/__init__.py&#39; not found (or not a regular file)
    package init file &#39;pyside_package/pysideuic/__init__.py&#39; not found (or not a regular file)
Installing collected packages: PySide
  Running setup.py install for PySide
    Removing /private/var/folders/xw/4lw_p32d0pg88hyg5rfn7vqxqhkgj_/T/pip-build-8_5xp5w9/PySide/pyside_package
    Python architecture is 64bit
    error: Failed to find cmake. Please specify the path to cmake with --cmake parameter.
    Complete output from command /usr/local/opt/python3/bin/python3.4 -c &quot;import setuptools, tokenize;__file__=&#39;/private/var/folders/xw/4lw_p32d0pg88hyg5rfn7vqxqhkgj_/T/pip-build-8_5xp5w9/PySide/setup.py&#39;;exec(compile(getattr(tokenize, &#39;open&#39;, open)(__file__).read().replace(&#39;\r\n&#39;, &#39;\n&#39;), __file__, &#39;exec&#39;))&quot; install --record /var/folders/xw/4lw_p32d0pg88hyg5rfn7vqxqhkgj_/T/pip-ugoc2jah-record/install-record.txt --single-version-externally-managed --compile:
    Removing /private/var/folders/xw/4lw_p32d0pg88hyg5rfn7vqxqhkgj_/T/pip-build-8_5xp5w9/PySide/pyside_package

    running install

    running build

    Python architecture is 64bit

    error: Failed to find cmake. Please specify the path to cmake with --cmake parameter.

    ----------------------------------------
    Command &quot;/usr/local/opt/python3/bin/python3.4 -c &quot;import setuptools, tokenize;__file__=&#39;/private/var/folders/xw/4lw_p32d0pg88hyg5rfn7vqxqhkgj_/T/pip-build-8_5xp5w9/PySide/setup.py&#39;;exec(compile(getattr(tokenize, &#39;open&#39;, open)(__file__).read().replace(&#39;\r\n&#39;, &#39;\n&#39;), __file__, &#39;exec&#39;))&quot; install --record /var/folders/xw/4lw_p32d0pg88hyg5rfn7vqxqhkgj_/T/pip-ugoc2jah-record/install-record.txt --single-version-externally-managed --compile&quot; failed with error code 1 in /private/var/folders/xw/4lw_p32d0pg88hyg5rfn7vqxqhkgj_/T/pip-build-8_5xp5w9/PySide
</code></pre>
<p>Trying to run <code>cmake</code> indicates it doesn't exist:</p>
<pre><code class="python">$ cmake
-bash: cmake: command not found
</code></pre>
<p>Maybe we can just install <code>cmake</code> using our package manager (<a href="http://brew.sh/">brew</a>) and it'll be happy? Let's try <code>brew install cmake</code>...</p>
<pre><code class="python">$ brew install cmake
==&gt; Downloading http://www.cmake.org/files/v3.1/cmake-3.1.2.tar.gz
######################################################################## 100.0%
==&gt; Downloading https://pypi.python.org/packages/source/S/Sphinx/Sphinx-1.2.3.tar.gz
######################################################################## 100.0%
==&gt; python -c import setuptools... --no-user-cfg install --prefix=/private/tmp/cmake-Kp5igT/cmake-3.1
==&gt; Downloading https://pypi.python.org/packages/source/d/docutils/docutils-0.12.tar.gz
######################################################################## 100.0%
==&gt; python -c import setuptools... --no-user-cfg install --prefix=/private/tmp/cmake-Kp5igT/cmake-3.1
==&gt; Downloading https://pypi.python.org/packages/source/P/Pygments/Pygments-2.0.2.tar.gz
######################################################################## 100.0%
==&gt; python -c import setuptools... --no-user-cfg install --prefix=/private/tmp/cmake-Kp5igT/cmake-3.1
==&gt; Downloading https://pypi.python.org/packages/source/J/Jinja2/Jinja2-2.7.3.tar.gz
######################################################################## 100.0%
==&gt; python -c import setuptools... --no-user-cfg install --prefix=/private/tmp/cmake-Kp5igT/cmake-3.1
==&gt; Downloading https://pypi.python.org/packages/source/M/MarkupSafe/MarkupSafe-0.23.tar.gz
######################################################################## 100.0%
==&gt; python -c import setuptools... --no-user-cfg install --prefix=/private/tmp/cmake-Kp5igT/cmake-3.1
==&gt; ./bootstrap --prefix=/usr/local/Cellar/cmake/3.1.2 --system-libs --parallel=8 --no-system-libarch
==&gt; make
==&gt; make install
/usr/local/Cellar/cmake/3.1.2: 1821 files, 29M, built in 5.1 minutes
</code></pre>
<p>After 5 long and painful minutes, it seems to have worked! And now the <code>cmake</code> command prints something:</p>
<pre><code class="python">$ cmake
Usage

  cmake [options] &lt;path-to-source&gt;
  cmake [options] &lt;path-to-existing-build&gt;

Specify a source directory to (re-)generate a build system for it in the
current working directory.  Specify an existing build directory to
re-generate its build system.

Run &#39;cmake --help&#39; for more information.
</code></pre>
<p>Let's try <code>pip3 install PySide</code> again...</p>
<pre><code class="python">$ pip3 install PySide
You are using pip version 6.0.8, however version 8.1.0 is available.
You should consider upgrading via the &#39;pip install --upgrade pip&#39; command.
Collecting PySide
  Using cached PySide-1.2.4.tar.gz
    Removing /private/var/folders/xw/4lw_p32d0pg88hyg5rfn7vqxqhkgj_/T/pip-build-dx05oahd/PySide/pyside_package
    package init file &#39;pyside_package/PySide/__init__.py&#39; not found (or not a regular file)
    package init file &#39;pyside_package/pysideuic/__init__.py&#39; not found (or not a regular file)
Installing collected packages: PySide
  Running setup.py install for PySide
    Removing /private/var/folders/xw/4lw_p32d0pg88hyg5rfn7vqxqhkgj_/T/pip-build-dx05oahd/PySide/pyside_package
    Python architecture is 64bit
    error: Failed to find qmake. Please specify the path to qmake with --qmake parameter.
    Complete output from command /usr/local/opt/python3/bin/python3.4 -c &quot;import setuptools, tokenize;__file__=&#39;/private/var/folders/xw/4lw_p32d0pg88hyg5rfn7vqxqhkgj_/T/pip-build-dx05oahd/PySide/setup.py&#39;;exec(compile(getattr(tokenize, &#39;open&#39;, open)(__file__).read().replace(&#39;\r\n&#39;, &#39;\n&#39;), __file__, &#39;exec&#39;))&quot; install --record /var/folders/xw/4lw_p32d0pg88hyg5rfn7vqxqhkgj_/T/pip-ln1fsrej-record/install-record.txt --single-version-externally-managed --compile:
    Removing /private/var/folders/xw/4lw_p32d0pg88hyg5rfn7vqxqhkgj_/T/pip-build-dx05oahd/PySide/pyside_package

    running install

    running build

    Python architecture is 64bit

    error: Failed to find qmake. Please specify the path to qmake with --qmake parameter.

    ----------------------------------------
    Command &quot;/usr/local/opt/python3/bin/python3.4 -c &quot;import setuptools, tokenize;__file__=&#39;/private/var/folders/xw/4lw_p32d0pg88hyg5rfn7vqxqhkgj_/T/pip-build-dx05oahd/PySide/setup.py&#39;;exec(compile(getattr(tokenize, &#39;open&#39;, open)(__file__).read().replace(&#39;\r\n&#39;, &#39;\n&#39;), __file__, &#39;exec&#39;))&quot; install --record /var/folders/xw/4lw_p32d0pg88hyg5rfn7vqxqhkgj_/T/pip-ln1fsrej-record/install-record.txt --single-version-externally-managed --compile&quot; failed with error code 1 in /private/var/folders/xw/4lw_p32d0pg88hyg5rfn7vqxqhkgj_/T/pip-build-dx05oahd/PySide
</code></pre>
<p>What on earth is <code>qmake</code>??? I certainly can't <code>brew install</code> it:</p>
<pre><code class="python">$ brew install qmake
Error: No available formula for qmake
Searching formulae...
Searching taps...
</code></pre>
<p>Googling <code>pyside qmake osx</code> gives:</p>
<ul>
  <li><a href="http://pyside.readthedocs.org/en/latest/building/macosx.html">http://pyside.readthedocs.org/en/latest/building/macosx.html</a></li>
</ul>
<p>It tells us to install <a href="https://developer.apple.com/xcode/">Xcode</a>, which I already have from earlier. After that, there's this magic command.</p>
<pre><code class="">brew install python qt
</code></pre>
<p>We've already just installed <code>cmake</code>, and have <code>python</code> installed as part of the whole Anaconda thing earlier. I guess we just need <a href="http://www.qt.io/">qt</a> to make the <code>qmake</code> command available. <code>brew install qt</code>...</p>
<pre><code class="python">$ brew install qt
==&gt; Downloading https://download.qt.io/official_releases/qt/4.8/4.8.6/qt-everywhere-opensource-src-4.

curl: (22) The requested URL returned error: 403 Forbidden
Trying a mirror...
==&gt; Downloading http://qtmirror.ics.com/pub/qtproject/official_releases/qt/4.8/4.8.6/qt-everywhere-op
######################################################################## 100.0%
==&gt; Downloading https://raw.githubusercontent.com/DomT4/scripts/440e3cafde5bf6ec6f50cd28fa5bf89c280f1
######################################################################## 100.0%
==&gt; Patching
patching file src/gui/dialogs/qcolordialog_mac.mm
patching file src/gui/dialogs/qfiledialog_mac.mm
patching file src/gui/dialogs/qfontdialog_mac.mm
patching file src/gui/kernel/qapplication_mac.mm
patching file src/gui/kernel/qcocoaapplication_mac.mm
patching file src/gui/kernel/qcocoaapplicationdelegate_mac.mm
Hunk #4 succeeded at 295 (offset -13 lines).
Hunk #5 succeeded at 342 (offset -13 lines).
patching file src/gui/kernel/qcocoaapplicationdelegate_mac_p.h
patching file src/gui/kernel/qcocoamenuloader_mac.mm
patching file src/gui/kernel/qcocoasharedwindowmethods_mac_p.h
patching file src/gui/kernel/qeventdispatcher_mac.mm
patching file src/gui/kernel/qt_cocoa_helpers_mac.mm
patching file src/gui/kernel/qwidget_mac.mm
patching file src/gui/styles/qmacstyle_mac.mm
patching file src/gui/util/qsystemtrayicon_mac.mm
patching file src/gui/widgets/qcocoamenu_mac.mm
patching file src/gui/widgets/qmenu_mac.mm
==&gt; ./configure -prefix /usr/local/Cellar/qt/4.8.6 -system-zlib -qt-libtiff -qt-libpng -qt-libjpeg -c
==&gt; make
2 errors generated.
make[2]: *** [.obj/release-shared/qpaintengine_mac.o] Error 1
make[2]: *** Waiting for unfinished jobs....
make[1]: *** [release] Error 2
make: *** [sub-gui-make_default-ordered] Error 2

READ THIS: http://git.io/brew-troubleshooting
</code></pre>
<p>Seems like installation timed out or something? Trying to run <code>qmake</code> certainly doesn't work yet. Googling <code>brew install qt timing out</code> gives us:</p>
<pre><code class="">https://github.com/Homebrew/homebrew/issues/30843
</code></pre>
<p>So it seems like it's not just our problem. Maybe running it again will work? If not we might go back and try installing <code>PyQt5</code> again using the long-ish instructions we found earlier.</p>
<p>It seems to have failed again:</p>
<pre><code class="python">==&gt; ./configure -prefix /usr/local/Cellar/qt/4.8.6 -system-zlib -qt-libtiff -qt-libpng -qt-libjpeg -c
==&gt; make
2 errors generated.
make[2]: *** [.obj/release-shared/qpaintengine_mac.o] Error 1
make[2]: *** Waiting for unfinished jobs....
make[1]: *** [release] Error 2
make: *** [sub-gui-make_default-ordered] Error 2

READ THIS: http://git.io/brew-troubleshooting
</code></pre><h3 id="back-to-pyqt5">Back to PyQt5</h3>
<p>Let's give up on PySide for now. I don't know why the installation doesn't work but it doesn't. It seems to require <code>qt</code> anyway which is probably not that different from what <code>PyQt4</code> requires.</p>
<p>Googling again for "osx PyQt5", I find </p>
<ul>
  <li><a href="https://pypi.python.org/pypi/pyqt5-macos-built">https://pypi.python.org/pypi/pyqt5-macos-built</a></li>
</ul>
<blockquote>
  <p>This package installs a prebuilt version of PyQt5 for Mac OS. It does not compile anything because uses an already precompiled one. </p>
</blockquote>
<p>I wonder if that would work? Avoiding compilation would certainly avoid the what-looks-like-a-compilation-timeout during the <code>make</code> command that was running while trying to <code>brew install qt</code>. Presumably any mechanism of trying to install <code>PyQt5</code> that needs compilation would need <code>qt</code> and bump into the same timeout? Anyway this seems to have installed successfully:</p>
<pre><code class="python">$ pip3 install pyqt5-macos-built
You are using pip version 6.0.8, however version 8.1.0 is available.
You should consider upgrading via the &#39;pip install --upgrade pip&#39; command.
Collecting pyqt5-macos-built
  Downloading pyqt5-macos-built-5.5.0.tar.gz (5.1MB)
    100% |################################| 5.1MB 124kB/s
    /usr/local/Cellar/python3/3.4.2_1/Frameworks/Python.framework/Versions/3.4/lib/python3.4/distutils/dist.py:260: UserWarning: Unknown distribution option: &#39;bugtrack_url&#39;
      warnings.warn(msg)
Collecting docopt (from pyqt5-macos-built)
  Downloading docopt-0.6.2.tar.gz
Installing collected packages: docopt, pyqt5-macos-built
  Running setup.py install for docopt
  Running setup.py install for pyqt5-macos-built
    changing mode of build/scripts-3.4/pyqt5_macos_built.py from 644 to 755
    /usr/local/Cellar/python3/3.4.2_1/Frameworks/Python.framework/Versions/3.4/lib/python3.4/distutils/dist.py:260: UserWarning: Unknown distribution option: &#39;bugtrack_url&#39;
      warnings.warn(msg
    changing mode of /usr/local/bin/pyqt5_macos_built.py to 755
Successfully installed docopt-0.6.2 pyqt5-macos-built-5.5.0
</code></pre>
<p>Oddly enough, trying to run <code>python3 bootstrap.py</code> seems to be failing claiming it can't find <code>PyQt5</code>, even though in the <code>python3</code> repl it imports just fine!</p>
<pre><code class="python">$ python3 bootstrap.py
Executing Spyder from source checkout
Revision df9577c, Branch: master
01. Patched sys.path with /Users/haoyi/test/spyder
02. PyQt5 is detected, selecting
Traceback (most recent call last):
  File &quot;/Users/haoyi/test/spyder/spyderlib/qt/__init__.py&quot;, line 62, in &lt;module&gt;
    from PySide import __version__  # analysis:ignore
ImportError: No module named &#39;PySide&#39;

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File &quot;bootstrap.py&quot;, line 140, in &lt;module&gt;
    versions = get_versions(reporev=False)
  File &quot;/Users/haoyi/test/spyder/spyderlib/__init__.py&quot;, line 65, in get_versions
    import spyderlib.qt
  File &quot;/Users/haoyi/test/spyder/spyderlib/qt/__init__.py&quot;, line 65, in &lt;module&gt;
    raise ImportError(&quot;Spyder requires PyQt5, PyQt4 or PySide (deprecated) &quot;
ImportError: Spyder requires PyQt5, PyQt4 or PySide (deprecated) to be installed
$ python3
Python 3.4.2 (default, Feb 10 2015, 03:38:22)
[GCC 4.2.1 Compatible Apple LLVM 6.0 (clang-600.0.56)] on darwin
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; import PyQt5
&gt;&gt;&gt;
</code></pre>
<p>Looking at the code performing the import in <code>spyderlib/qt/__init__.py</code>:</p>
<pre><code class="python">if API == &#39;pyqt5&#39;:
    try:
        from PyQt5.QtCore import PYQT_VERSION_STR as __version__
        from PyQt5 import uic  # analysis:ignore
    except ImportError:
        API = os.environ[&#39;QT_API&#39;] = &#39;pyqt&#39;
        API_NAME = &#39;PyQt4&#39;
</code></pre>
<p>Seems like it's running into an <code>ImportError</code> that's resulting in a failure down below in the same file? We can try running those imports in the <code>python3</code> REPL, and lo-and-behold they fail:</p>
<pre><code class="python">$ python3
Python 3.4.2 (default, Feb 10 2015, 03:38:22)
[GCC 4.2.1 Compatible Apple LLVM 6.0 (clang-600.0.56)] on darwin
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; from PyQt5.QtCore import PYQT_VERSION_STR as __version__
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
ImportError: dlopen(/usr/local/lib/python3.4/site-packages/PyQt5/QtCore.so, 2): Library not loaded: /usr/local/opt/qt5/lib/QtCore.framework/Versions/5/QtCore
  Referenced from: /usr/local/lib/python3.4/site-packages/PyQt5/QtCore.so
  Reason: image not found
&gt;&gt;&gt;
</code></pre>
<p>No luck; even though it seems you can <code>import PyQt5</code>, doing <code>from PyQt5.Core import PYQT_VERSION_STR as __version__</code> seems to blow up. Seems like some binary dependency was not properly installed? Maybe the <code>pyqt5-macos-built</code> package is missing some QT dependency it needs.</p>
<p>Googling "Library not loaded QtCore" find us:</p>
<ul>
  <li><a href="http://stackoverflow.com/questions/25656307/pyside-qt-import-error">http://stackoverflow.com/questions/25656307/pyside-qt-import-error</a></li>
</ul>
<p>Maybe if <code>brew install qt</code> doesn't work then <code>brew install qt5</code> will???</p>
<p>This seems to be taking forever. It turns out that you can install python packages through <code>conda</code> as well as through <code>pip</code>. Googling "Anaconda pyqt5" gives us</p>
<ul>
  <li><a href="http://stackoverflow.com/questions/25468397/using-anaconda-python-with-pyqt5">http://stackoverflow.com/questions/25468397/using-anaconda-python-with-pyqt5</a></li>
</ul>
<pre><code class="python">conda config --add channels dsdale24 
conda install pyqt5
</code></pre>
<p>Which appears not to work due to python3 being <em>something something</em> incompatible with pyqt5 <em>something something</em>. Turns out that the Anaconda package for <code>pyqt5</code> only works with Python 2.7! </p>
<pre><code class="python">$ conda info pyqt5
Using Anaconda Cloud api site https://api.anaconda.org
Fetching package metadata: ......

pyqt5 5.3.1 py27_0
------------------
...
</code></pre>
<p>Luckily <code>conda</code> has a lot of useful commands, including a <code>search</code> command that could help us find something similar that might work:</p>
<pre><code class="python">$ conda
usage: conda [-h] [-V] [--debug] command ...

conda is a tool for managing and deploying applications, environments and packages.

Options:

positional arguments:
  command
    info         Display information about current conda install.
    help         Displays a list of available conda commands and their help
                 strings.
    list         List linked packages in a conda environment.
    search       Search for packages and display their information. The input
                 is a Python regular expression. To perform a search with a
                 search string that starts with a -, separate the search from
                 the options with --, like &#39;conda search -- -h&#39;. A * in the
                 results means that package is installed in the current
                 environment. A . means that package is not installed but is
                 cached in the pkgs directory.
</code></pre>
<p>Could it find a version of <code>pyqt</code> that would work with Python 3???</p>
<pre><code class="python">$ conda search pyqt
Using Anaconda Cloud api site https://api.anaconda.org
Fetching package metadata: ......
pyqt                         4.10.4                   py26_0  defaults
                             4.10.4                   py27_0  defaults
                             4.10.4                   py33_0  defaults
                             4.10.4                   py34_0  defaults
                             4.11.3                   py26_0  defaults
                             4.11.3                   py27_0  defaults
                             4.11.3                   py33_0  defaults
                             4.11.3                   py34_0  defaults
                             4.11.3                   py35_0  defaults
                             4.11.4                   py27_0  defaults
                             4.11.4                   py34_0  defaults
                             4.11.4                   py35_0  defaults
                             4.11.4                   py27_1  defaults
                             4.11.4                   py34_1  defaults
                          *  4.11.4                   py35_1  defaults
pyqt5                        5.3.1                    py27_0  dsdale24
pyqtgraph                    0.9.10                   py27_0  defaults
                             0.9.10                   py34_0  defaults
                             0.9.10                   py35_0  defaults
                             0.9.10                   py27_1  defaults
                             0.9.10                   py34_1  defaults
                             0.9.10                   py35_1  defaults
</code></pre>
<p><code>pyqt</code> seems to have packages for <code>py35_0</code> (which is where we are) even though <code>pyqt5</code> doesn't. Maybe we should install that instead? </p>
<p>Using <code>pyqt</code> (which is version 4) seems to work:</p>
<pre><code class="">$ conda install pyqt
Using Anaconda Cloud api site https://api.anaconda.org
Fetching package metadata: ......
Solving package specifications: ..........................
Package plan for installation in environment /Users/haoyi/anaconda3:

The following packages will be downloaded:

    package                    |            build
    ---------------------------|-----------------
    openssl-1.0.2g             |                0         3.0 MB
    xz-5.0.5                   |                1         173 KB
    setuptools-20.2.2          |           py35_0         458 KB
    wheel-0.29.0               |           py35_0          82 KB
    conda-4.0.4                |           py35_0         188 KB
    pip-8.1.0                  |           py35_0         1.6 MB
    ------------------------------------------------------------
                                           Total:         5.4 MB

The following packages will be UPDATED:

    conda:      3.19.1-py35_0 --&gt; 4.0.4-py35_0
    openssl:    1.0.2f-0      --&gt; 1.0.2g-0
    pip:        8.0.2-py35_0  --&gt; 8.1.0-py35_0
    setuptools: 19.6.2-py35_0 --&gt; 20.2.2-py35_0
    wheel:      0.26.0-py35_1 --&gt; 0.29.0-py35_0
    xz:         5.0.5-0       --&gt; 5.0.5-1

Proceed ([y]/n)? y

Fetching packages ...
openssl-1.0.2g 100% |#####################################################| Time: 0:00:08 393.54 kB/s
xz-5.0.5-1.tar 100% |#####################################################| Time: 0:00:00 184.22 kB/s
setuptools-20. 100% |#####################################################| Time: 0:00:01 238.96 kB/s
wheel-0.29.0-p 100% |#####################################################| Time: 0:00:00 102.15 kB/s
conda-4.0.4-py 100% |#####################################################| Time: 0:00:00 199.95 kB/s
pip-8.1.0-py35 100% |#####################################################| Time: 0:00:02 673.73 kB/s
Extracting packages ...
[      COMPLETE      ]|########################################################################| 100%
Unlinking packages ...
[      COMPLETE      ]|########################################################################| 100%
Linking packages ...
[      COMPLETE      ]|########################################################################| 100%
$ 
</code></pre>
<p>Now it seems to not crash when I run the bootstrap script!</p>
<pre><code class="">$ python3 bootstrap.py
Executing Spyder from source checkout
Revision df9577c, Branch: master
01. Patched sys.path with /Users/haoyi/test/spyder
02. PyQt4 is detected, selecting
03. Imported Spyder 3.0.0dev
    [Python 3.5.1 64bits, Qt 4.8.7, PyQt4 (API v2) 4.11.4 on Darwin]
04. Running Spyder
</code></pre>
<p>Or not</p>
<pre><code class="">Bootstrap completed in 00:00:13.3716
Traceback (most recent call last):
  File &quot;bootstrap.py&quot;, line 162, in &lt;module&gt;
    start.main()
  File &quot;/Users/haoyi/test/spyder/spyderlib/app/start.py&quot;, line 118, in main
    from spyderlib.app import spyder
  File &quot;/Users/haoyi/test/spyder/spyderlib/app/spyder.py&quot;, line 99, in &lt;module&gt;
    from spyderlib.utils.qthelpers import qapplication
  File &quot;/Users/haoyi/test/spyder/spyderlib/utils/qthelpers.py&quot;, line 16, in &lt;module&gt;
    import spyderlib.utils.icon_manager as ima
  File &quot;/Users/haoyi/test/spyder/spyderlib/utils/icon_manager.py&quot;, line 14, in &lt;module&gt;
    import qtawesome as qta
ImportError: No module named &#39;qtawesome&#39;
</code></pre>
<p>What on earth is that? I can't seem to <code>conda install</code> it, but the build-in search pulls up something that looks promising</p>
<pre><code class="">$ conda install qtawesome
Using Anaconda Cloud api site https://api.anaconda.org
Fetching package metadata: ......
Solving package specifications: .
Error:  Package missing in current osx-64 channels:
  - qtawesome

You can search for this package on anaconda.org with

    anaconda search -t conda qtawesome
$ anaconda search -t conda qtawesome
Using Anaconda Cloud api site https://api.anaconda.org
Run &#39;anaconda show &lt;USER/PACKAGE&gt;&#39; to get more details:
Packages:
     Name                      |  Version | Package Types   | Platforms
     ------------------------- |   ------ | --------------- | ---------------
     lightmotif/qtawesome      |   0.1.10 | conda           | win-32
                                          : FontAwesome icons in PyQt and PySide applications
     spyder-ide/qtawesome      |    0.2.0 | conda           | None-None
                                          : Iconic fonts in PyQt and PySide applications
Found 2 packages
</code></pre>
<p>I wonder how I can install that?</p>
<p>Googling <code>qtawesome</code> pulls this up:</p>
<ul>
  <li><a href="https://pypi.python.org/pypi/QtAwesome">https://pypi.python.org/pypi/QtAwesome</a></li>
</ul>
<p>Seems like some kind of <a href="http://fortawesome.github.io/Font-Awesome/">font-awesome</a>-for-Qt thing. I guess they use it to make the arrows and stuff look nice.</p>
<p>Installing using <code>pip3</code> seems to work. I guess <code>conda install</code> and <code>pip3</code> install are diferent some how? Anyway <code>pip3</code> reports success:</p>
<pre><code class="">$ pip3 install QtAwesome
You are using pip version 6.0.8, however version 8.1.0 is available.
You should consider upgrading via the &#39;pip install --upgrade pip&#39; command.
Collecting QtAwesome
  Downloading QtAwesome-0.3.1-py2.py3-none-any.whl (149kB)
    100% |################################| 151kB 2.7MB/s
Collecting qtpy (from QtAwesome)
  Downloading QtPy-0.1.3-py2.py3-none-any.whl
Collecting six (from QtAwesome)
  Using cached six-1.10.0-py2.py3-none-any.whl
Installing collected packages: six, qtpy, QtAwesome



Successfully installed QtAwesome-0.3.1 qtpy-0.1.3 six-1.10.0
</code></pre>
<p>But it doesn't actually work when I try to import it.</p>
<pre><code class="">$ python3
Python 3.5.1 |Anaconda 2.5.0 (x86_64)| (default, Dec  7 2015, 11:24:55)
[GCC 4.2.1 (Apple Inc. build 5577)] on darwin
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; import qtawesome
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
ImportError: No module named &#39;qtawesome&#39;
&gt;&gt;&gt;
</code></pre>
<p>Googling <code>conda install &quot;qtawesome&quot;</code> (note the quotes are necessary to avoid google splitting it into two words!) brings up this:</p>
<ul>
  <li><a href="https://anaconda.org/lightmotif/qtawesome">https://anaconda.org/lightmotif/qtawesome</a></li>
</ul>
<p>Which doesn't work:</p>
<pre><code class="">$ conda install -c https://conda.anaconda.org/lightmotif qtawesome
Using Anaconda Cloud api site https://api.anaconda.org
Fetching package metadata: ........
Solving package specifications: .
Error:  Package missing in current osx-64 channels:
  - qtawesome

You can search for this package on anaconda.org with

    anaconda search -t conda qtawesome
</code></pre>
<p>but this does though, using the "other" <code>foo/qtawesome</code> name that was listed by the <code>anaconda search</code> earlier:</p>
<pre><code class="">$ conda install -c https://conda.anaconda.org/spyder-ide qtawesome
Using Anaconda Cloud api site https://api.anaconda.org
Fetching package metadata: ........
Solving package specifications: ..........

Package plan for installation in environment /Users/haoyi/anaconda3:

The following packages will be downloaded:

    package                    |            build
    ---------------------------|-----------------
    qtpy-1.0b1                 |             py_0          10 KB
    qtawesome-0.2.0            |             py_0         146 KB
    ------------------------------------------------------------
                                           Total:         156 KB

The following NEW packages will be INSTALLED:

    qtawesome: 0.2.0-py_0
    qtpy:      1.0b1-py_0

Proceed ([y]/n)? y

Fetching packages ...
qtpy-1.0b1-py_ 100% |#####################################################| Time: 0:00:00  38.93 kB/s
qtawesome-0.2. 100% |#####################################################| Time: 0:00:01 106.19 kB/s
Extracting packages ...
[      COMPLETE      ]|########################################################################| 100%
Linking packages ...
[      COMPLETE      ]|########################################################################| 100%
</code></pre>
<p>And now after <code>python3 bootstrap.py</code>, it's alive!</p>
<p><div style="text-align: center"><img src="Diving/SpyderSplash.png" alt="Diving/SpyderSplash.png" style="max-width: 100%; max-height: 500px" /></div></p>
<p>Or not</p>
<pre><code class="">Bootstrap completed in 00:00:01.8318
Traceback (most recent call last):
  File &quot;/Users/haoyi/test/spyder/spyderlib/app/spyder.py&quot;, line 3130, in main
    mainwindow = run_spyder(app, options, args)
  File &quot;/Users/haoyi/test/spyder/spyderlib/app/spyder.py&quot;, line 3026, in run_spyder
    main.post_visible_setup()
  File &quot;/Users/haoyi/test/spyder/spyderlib/app/spyder.py&quot;, line 1316, in post_visible_setup
    self.report_missing_dependencies()
  File &quot;/Users/haoyi/test/spyder/spyderlib/app/spyder.py&quot;, line 1322, in report_missing_dependencies
    missing_deps = dependencies.missing_dependencies()
  File &quot;/Users/haoyi/test/spyder/spyderlib/dependencies.py&quot;, line 108, in missing_dependencies
    if not dependency.check() and not dependency.optional:
  File &quot;/Users/haoyi/test/spyder/spyderlib/dependencies.py&quot;, line 46, in check
    self.installed_version)
  File &quot;/Users/haoyi/test/spyder/spyderlib/utils/programs.py&quot;, line 429, in is_module_installed
    actver = get_module_version(module_name)
  File &quot;/Users/haoyi/test/spyder/spyderlib/utils/programs.py&quot;, line 371, in get_module_version
    mod = __import__(module_name)
  File &quot;/Users/haoyi/anaconda3/lib/python3.5/site-packages/jedi/__init__.py&quot;, line 41, in &lt;module&gt;
    from jedi.api import Script, Interpreter, NotFoundError, set_debug_function
  File &quot;/Users/haoyi/anaconda3/lib/python3.5/site-packages/jedi/api/__init__.py&quot;, line 16, in &lt;module&gt;
    from jedi.parser import Parser, load_grammar
  File &quot;/Users/haoyi/anaconda3/lib/python3.5/site-packages/jedi/parser/__init__.py&quot;, line 21, in &lt;module&gt;
    from jedi.parser import tree as pt
  File &quot;/Users/haoyi/anaconda3/lib/python3.5/site-packages/jedi/parser/tree.py&quot;, line 39, in &lt;module&gt;
    from jedi import cache
  File &quot;/Users/haoyi/anaconda3/lib/python3.5/site-packages/jedi/cache.py&quot;, line 32, in &lt;module&gt;
    from jedi import debug
  File &quot;/Users/haoyi/anaconda3/lib/python3.5/site-packages/jedi/debug.py&quot;, line 17, in &lt;module&gt;
    init()
  File &quot;/Users/haoyi/anaconda3/lib/python3.5/site-packages/colorama/initialise.py&quot;, line 37, in init
    wrap_stream(orig_stdout, convert, strip, autoreset, wrap)
  File &quot;/Users/haoyi/anaconda3/lib/python3.5/site-packages/colorama/initialise.py&quot;, line 76, in wrap_stream
    convert=convert, strip=strip, autoreset=autoreset)
  File &quot;/Users/haoyi/anaconda3/lib/python3.5/site-packages/colorama/ansitowin32.py&quot;, line 67, in __init__
    strip = conversion_supported or (not wrapped.closed and not is_a_tty(wrapped))
AttributeError: &#39;SysOutput&#39; object has no attribute &#39;closed&#39;
</code></pre>
<p>Googling the error message brings us to</p>
<ul>
  <li><a href="https://github.com/spyder-ide/spyder/issues/2984">https://github.com/spyder-ide/spyder/issues/2984</a></li>
</ul>
<p>Seems the solution is one of either</p>
<ul>
  <li><code>pip install colorama==0.3.5</code></li>
  <li><code>conda install colorama=0.3.3</code></li>
</ul>
<p>Depending on which of the people posting on that issue you believe. The first one doesn't seem to work, but the second one does. Spyder boots up!</p>
<p>And shows:</p>
<p><div style="text-align: center"><img src="Diving/SpyderDependencies.png" alt="Diving/SpyderDependencies.png" style="max-width: 100%; max-height: 500px" /></div></p>
<p>But that's a simple <code>conda install pylint</code> away, and then it works!</p>
<p><div style="text-align: center"><img src="Diving/SpyderWorks.png" alt="Diving/SpyderWorks.png" style="max-width: 100%; max-height: 500px" /></div></p>
<p>I notice that if I leave it running long enough (2-3 minutes?) it dies with</p>
<pre><code class="">Segmentation fault: 11
</code></pre>
<p>So it's not totally stable. But it's stable enough for us to run and test out changes, so for now, this is good enough!</p>
<hr/>
<p>By now about 2 hours have passed since I first started trying to make a change to the Spyder "Scientific Python" IDE. We finally managed to get it booting up under "development" mode from source, which is the most important step in trying to understand a foreign codebase. So far, we've only glanced at the code once or twice to try and figure out why dependencies didn't work; the next step would be to dive into the code in order to figure out what's what.</p><h2 id="familiarization">Familiarization</h2>
<p>As mentioned earlier, digging through the code of an unfamiliar project happens in stages: the first stage is usually a coarse-grained browsing of the various files and folders, seeing what's where and what kinds of "stuff" the project contains. Only after that do you dive into looking for the specific "thing" that you want.</p><h3 id="touring-the-code">Touring the Code</h3>
<p>The main top-folders that appear to be in the Spyder project are:</p>
<ul>
  <li><code>app_example/</code>: obviously some kind of example application, probably not the main code</li>
  <li><code>conda.recipe/</code>: some kind of integration with Anaconda, to let people install Spyder easily</li>
  <li><code>continuous_integration/</code>: something related to running automated unit tests</li>
  <li><code>doc/</code>: documentation site?</li>
  <li><code>img_src/</code>: no idea</li>
  <li><code>rope_profiling/</code>: <code>rope</code> is the name of a Python AST processing/code-rewriting  library. No idea why it needs to be profiled</li>
  <li><code>scripts/</code>: probably ad-hoc things that developers run that aren't part of  the main code</li>
  <li><code>spyderlib/</code>: the IDE itself, as a library. Most of the code is probably here</li>
  <li><code>spyplugins/</code>: plugins to the IDE; depending on what the architecture looks  like, this could contain minor tweaks, or it could include whoel swathes of  IDE functionality the way plugins work in IntelliJ.</li>
</ul>
<p>Another thing to do is to simply do a line-count of the code that exists in the repository. This doesn't give us a huge amount of detail, but it does tell us what kind of beast are we looking at. Thousands of lines of code? Tens of thousands? Millions?</p>
<pre><code class="python">$ find . -name &quot;*.py&quot; | xargs wc -l
...
   58606 total
</code></pre>
<p>58 thousand lines of Python. Not enormous, but not a small codebase by any means! We can quickly confirm that most of the "stuff" is in the <code>spyderlib/</code> folder:</p>
<pre><code class="python">find spyderlib -name &quot;*.py&quot; | xargs wc -l
...
   54799 total
</code></pre><h3 id="spyderlib">Spyderlib</h3>
<p>Poking around <code>spyderlib/</code> in a file browser, it becomes pretty obvious what the main folders inside contain:</p>
<ul>
  <li><code>app/</code>: seems to contain the "entry point" code that kicks off the Spyder  IDE. In theory, when you run Spyder, this is the first file that should  be loaded.</li>
  <li><code>config/</code> &amp; <code>defaults/</code>: the code related to loading user-definable  configuration from files, and the defaults for all the configuration if not  set.</li>
  <li><code>fonts/</code> &amp; <code>images/</code>: non-code resources necessary to make the IDE look pretty</li>
  <li><code>locale/</code>: translations and translation-related stuff. Seems they support  Spanish (<code>es/</code>), French (<code>fr/</code>) and Brazilian Portuguese (<code>pt_BR/</code>)</li>
  <li><code>plugins/</code>: probably parts of the code that can easily be included or  excluded, enabled/disabled, since that's what plugins typically are.</li>
  <li><code>qt/</code>: seems to be mostly shims that swap between the <code>PyQt4</code>/<code>PyQt5</code>/<code>PySide</code>,  GUI libraries. Seems to import the one that works for the rest of the code to  use. Doesn't seem to actually define any UI code itself.</li>
  <li><code>utils/</code>: a grab bag of random functionality that probably doesn't depend on  anything else in the codebase. Also contains a whole pile of Javascript/HTML/CSS  code to render some kind of help site</li>
  <li><code>widgets/</code>: the real building blocks of the Spyder GUI. Each file appears to  contain one individual widget: a file-switcher widget, a find-replace widget,  and so on</li>
  <li><code>windows/</code>: contains two icons to put on the top-left of the window when  running on Windows</li>
  <li><code>workers/</code>: seems like it should contain all sorts of asynchronous task  workers, but only contains code for a single worker that polls github</li>
</ul>
<hr/>
<p>That's probably enough for a rough tour for now. For the next stage in familiarization, we will dig into one particular change that we want to make. This should let us exercise some of the knowledge that we just gained by browsing through the codebase, as well as learn deeper things about it.</p><h2 id="hello-world">Hello World</h2>
<p>The next step, now that we've got the code running and have gone through at a high level, is to make a "hello world" change to make sure that we are indeed able to make changes to the code and execute the code with our changes. One common hello world change is to change some text somewhere in the application. For example, let's change the title of the window:</p>
<p><div style="text-align: center"><img src="Diving/SpyderTitle.png" alt="Diving/SpyderWorks.png" style="max-width: 100%; max-height: 500px" /></div></p>
<p>From <code>Spyder 3.0.0dev (Python 3.5)</code> to, say, <code>Spyder Hello World...</code>.</p>
<p>This thing looks like a title. The same thing (label at top of window) is called the <code>title</code> in HTML, Java Swing, and every other GUI framework I've used, so I'd bet it's called <code>title</code> here too. Let's search the codebase for <code>title</code>:</p>
<p><div style="text-align: center"><img src="Diving/SpyderSearch.png" alt="Diving/SpyderSearch.png" style="max-width: 100%; max-height: 500px" /></div></p>
<p>460 occurrences! That seems like a lot! But actually it really isn't. You should be able to skim through the 460 occurrences in less than 5 minutes. Many of them are setting the title on various modals, some others are titles in other languages such as HTML. Nevertheless, we should glance every find: it's entirely possible that the title is coming from some config <code>.ini</code> or <code>.json</code> file or similar and isn't being explicitly set in <code>.py</code> code at all!</p>
<p>In this case, we're lucky and this seems like what we want:</p>
<p><div style="text-align: center"><img src="Diving/SpyderFound.png" alt="Diving/SpyderFound.png" style="max-width: 100%; max-height: 500px" /></div></p>
<p>If we weren't lucky, we'd have to try other keywords to search, or even start tracing through the execution of the code to find where it starts instantiating the GUI. But we were lucky, and so found the relevant code in less than 5 minutes:</p>
<pre><code class="python"># Set Window title and icon
if DEV is not None:
    title = &quot;Spyder %s (Python %s.%s)&quot; % (__version__,
                                          sys.version_info[0],
                                          sys.version_info[1])
else:
    title = &quot;Spyder (Python %s.%s)&quot; % (sys.version_info[0],
                                       sys.version_info[1])
if DEBUG:
    title += &quot; [DEBUG MODE %d]&quot; % DEBUG
</code></pre>
<p>Browsing around, this file appears to be both the entry-point where Spyder starts, as well as a huge mass of logic related what the Spyder IDE does. At 3168 lines of code, it's definitely not just an initialization stub! It seems to be registering shortcuts with <code>self.register_shortcut</code>, fiddling with <a href="https://en.wikipedia.org/wiki/Unix_signal">OS signals</a>, working with sessions (whatever those are in the context of an IDE), fiddling with <code>env</code> variables, and waaaay at the bottom of the three thousand lines we see the signature of a Python program entry-point:</p>
<pre><code class="python">if __name__ == &quot;__main__&quot;:
    main()
</code></pre>
<p>Coming back to the snippet of code we found, changing the title to <code>Spyder Hello World...</code> is a matter of tweaking the string:</p>
<pre><code class="diff">$ git diff
diff --git a/spyderlib/app/spyder.py b/spyderlib/app/spyder.py
index 6d9763f..830e8f3 100644
--- a/spyderlib/app/spyder.py
+++ b/spyderlib/app/spyder.py
@@ -436,7 +436,7 @@ class MainWindow(QMainWindow):

         # Set Window title and icon
         if DEV is not None:
-            title = &quot;Spyder %s (Python %s.%s)&quot; % (__version__,
+            title = &quot;Spyder Hello World %s (Python %s.%s)&quot; % (__version__,
                                                   sys.version_info[0],
                                                   sys.version_info[1])
         else:
</code></pre>
<p>And re-running <code>python bootstrap.py</code>. And there we have it</p>
<p><div style="text-align: center"><img src="Diving/SpyderTitleChanged.png" alt="Diving/SpyderTitleChanged.png" style="max-width: 100%; max-height: 500px" /></div></p>
<p>Our first change works!</p><h2 id="iteration">Iteration</h2>
<p>The initial problem statement was that we were to add a new menu dropdown at the top of the screen, next to the existing <code>Help</code> menu:</p>
<p><div style="text-align: center"><img src="Diving/SpyderMenus.png" alt="Diving/SpyderMenus.png" style="max-width: 100%; max-height: 500px" /></div></p>
<p>One way to find where those menus are being defined is to search for the word <code>menu</code> within the codebase. Assuming the developers use the same vocabulary as you thought they do, that should pull it up as part of a larger search that you could trawl through to find it. Another technique is to search for a string that's part of those menus, that's hopefully long enough to be unique, and that should bring us to the definition of that string right away.</p>
<p>In this case, I'm going to search for <code>Consoles</code> within the codebase, with case sensitive search on, in the hope that there won't be <em>that</em> many places where the <code>Consoles</code> string turns up: after all, in Python variables and module-names would all be lower-case, and non-Python usages (e.g. HTML docs) or comments are easy to ignore. That brings up about a dozen results, mostly in <code>.md</code> and <code>.rst</code> and <code>.po</code> files</p>
<p><div style="text-align: center"><img src="Diving/MenuSearch.png" alt="Diving/MenuSearch.png" style="max-width: 100%; max-height: 500px" /></div></p>
<p>Unusually, none of them initially appear to be what I want: they're mostly parts of long help-pages, or comments. However, one of the comments seems suspicious:</p>
<pre><code class="python"># Consoles menu/toolbar
</code></pre>
<p>Looking at that code, we see:</p>
<pre><code class="python"># Debug menu/toolbar
self.debug_menu = self.menuBar().addMenu(_(&quot;&amp;Debug&quot;))
self.debug_toolbar = self.create_toolbar(_(&quot;Debug toolbar&quot;),
                                            &quot;debug_toolbar&quot;)

# Consoles menu/toolbar
self.consoles_menu = self.menuBar().addMenu(_(&quot;C&amp;onsoles&quot;))

# Tools menu
self.tools_menu = self.menuBar().addMenu(_(&quot;&amp;Tools&quot;))
</code></pre>
<p>Aha! That seems like what we want! This is the code that is hard-coded to append all the dropdown-menus to the toolbar. For some reason there's this weird <code>&amp;</code> character before or in the middle of all the names; that's probably some magic syntax to make it tread the next character as the shortcut key for that menu. It doesn't seem to work on OS-X, but on the original screenshot presumably on Windows you can see the underlined characters indicating the hotkeys all in the right places:</p>
<p><div style="text-align: center"><img src="Diving/Spyder.png" alt="Diving/Spyder.png" style="max-width: 100%; max-height: 500px" /></div></p>
<p>From there it's relatively straightforward to add a new menu to the menu bar:</p>
<pre><code class="diff">$ git diff
diff --git a/spyderlib/app/spyder.py b/spyderlib/app/spyder.py
index 6d9763f..c855220 100644
--- a/spyderlib/app/spyder.py
+++ b/spyderlib/app/spyder.py
@@ -663,6 +663,9 @@ class MainWindow(QMainWindow):
         # Help menu
         self.help_menu = self.menuBar().addMenu(_(&quot;&amp;Help&quot;))

+        # Help menu
+        self.misc_menu = self.menuBar().addMenu(_(&quot;&amp;Misc&quot;))
+
         # Status bar
         status = self.statusBar()
         status.setObjectName(&quot;StatusBar&quot;)
</code></pre>
<p>And there we have it, a <code>Misc</code> menu!</p>
<p><div style="text-align: center"><img src="Diving/MiscMenu.png" alt="Diving/MiscMenu.png" style="max-width: 100%; max-height: 500px" /></div></p>
<p>Currently, this menu doesn't seem to do anything. Clicking on it doesn't even drop down a list of menu items. Presumably that's because there aren't even any items in that menu yet; we haven't added any. The next step would be to figure out how every other menu is adding menu items, and copying them to add our own menu items.</p><h3 id="rolling-in-mud">Rolling in Mud</h3>
<p>Clearly the menu items are not added at the place we found above; that simply initializes each dropdown menu with a name. They have to be added elsewhere. We can easily search for the use sites of a menu to see where it's being used, and if anyone seems to be adding stuff to it. e.g. searching for the use sites of <code>console_menu</code>:</p>
<p><div style="text-align: center"><img src="Diving/ConsoleMenuSearch.png" alt="Diving/ConsoleMenuSearch.png" style="max-width: 100%; max-height: 500px" /></div></p>
<p>Immediately, we can see that apart from the code initializing the <code>self.consoles_menu</code>, there is also code setting it to <code>None</code>, code setting <code>self.console_menu_actions</code> to <code>None</code>, and code calling this seemingly-relevant <code>add_actions</code> function on <code>self.consoles_menu</code> and <code>self.consoles_menu__actions</code>. That's great. We can call the same thing. But <code>consoles_menu_actions</code> starts off empty, and what on earth is going into it? We can easily search and find out:</p>
<p><div style="text-align: center"><img src="Diving/ConsolesMenuActions.png" alt="Diving/ConsolesMenuActions.png" style="max-width: 100%; max-height: 500px" /></div></p>
<p>Clearly it's a list with an <code>interpreter_action</code> in it. Where does that come from? It's relatively trivial to <code>Cmd-F</code> in that file and find it:</p>
<pre><code class="python">interpreter_action = create_action(self,
                    _(&quot;Open a &amp;Python console&quot;), None,
                    ima.icon(&#39;python&#39;),
                    triggered=self.open_interpreter)
if os.name == &#39;nt&#39;:
    text = _(&quot;Open &amp;command prompt&quot;)
    tip = _(&quot;Open a Windows command prompt&quot;)
else:
    text = _(&quot;Open a &amp;terminal&quot;)
    tip = _(&quot;Open a terminal window&quot;)
terminal_action = create_action(self, text, None, None, tip,
                                triggered=self.open_terminal)
run_action = create_action(self,
                    _(&quot;&amp;Run...&quot;), None,
                    ima.icon(&#39;run_small&#39;), _(&quot;Run a Python script&quot;),
                    triggered=self.run_script)

consoles_menu_actions = [interpreter_action]
</code></pre>
<p>Seems relatively straightforward: you call <code>create_action</code>, pass in <code>self</code> (whatever that is), some kind of <code>_(...)</code>-wrapped string, <code>None</code>, some icon, and a <code>triggered</code> argument that looks like the callback. We can easily jump to (or grep for) the definition of <code>create_action</code>, find it in <code>spyderlib/utils/qthelpers.py</code>, and see what it does:</p>
<pre><code class="python">def create_action(parent, text, shortcut=None, icon=None, tip=None,
                  toggled=None, triggered=None, data=None, menurole=None,
                  context=Qt.WindowShortcut):
    action = QAction(text, parent)
    if triggered is not None:
        action.triggered.connect(triggered)
    if toggled is not None:
        action.toggled.connect(toggled)
        action.setCheckable(True)
    ...
    return action
</code></pre>
<p>Seems like the <code>None</code> being passed in is that shortcut; I guess there isn't any shortcut for <code>Open a Python Console</code>? I don't know what the <code>data</code> or <code>menurole</code> arguments do but I probably don't need to for now. Next thing to look at would be the <code>self.open_interpreter</code> function that's being passed in:</p>
<pre><code class="python">@Slot(str)
def open_interpreter(self, wdir=None):
    &quot;&quot;&quot;Open interpreter&quot;&quot;&quot;
    if not wdir:
        wdir = getcwd()
    self.visibility_changed(True)
    self.start(fname=None, wdir=to_text_string(wdir), args=&#39;&#39;,
               interact=True, debug=False, python=True)
</code></pre>
<p>No clue what that <code>@Slot(str)</code> thing is, but it appears that each callback (e.g. the <code>run_action</code> shown in the above snippet) all have a <code>@Slots</code> decorator that matches the number of arguments the callback takes. I guess we can just follow that convention and it should keep working.</p>
<p>Otherwise it seems relatively straightforward: it calls some methods that do things. That's great. I know how to write functions that call methods to do things too!</p><h3 id="our-own-action">Our own Action</h3>
<p>We've seen where the <code>foo_menu_actions</code> lists get created, where they get appended to, where they get passed in to <code>add_actions</code> to append them to the menus themselves. It now isn't hard to monkey what they're doing to get our own custom action plumbed through the flow:</p>
<pre><code class="diff">$ git --no-pager diff
diff --git a/spyderlib/app/spyder.py b/spyderlib/app/spyder.py
index 6d9763f..44fb373 100644
--- a/spyderlib/app/spyder.py
+++ b/spyderlib/app/spyder.py
@@ -408,6 +408,8 @@ class MainWindow(QMainWindow):
         self.toolbars_menu = None
         self.help_menu = None
         self.help_menu_actions = []
+        self.misc_menu_actions = []
+

         # Status bar widgets
         self.mem_status = None
@@ -663,6 +665,9 @@ class MainWindow(QMainWindow):
         # Help menu
         self.help_menu = self.menuBar().addMenu(_(&quot;&amp;Help&quot;))

+        # Misc menu
+        self.misc_menu = self.menuBar().addMenu(_(&quot;&amp;Misc&quot;))
+
         # Status bar
         status = self.statusBar()
         status.setObjectName(&quot;StatusBar&quot;)
@@ -1181,6 +1186,8 @@ class MainWindow(QMainWindow):
                     self.external_tools_menu_actions)
         add_actions(self.help_menu, self.help_menu_actions)

+        add_actions(self.misc_menu, self.misc_menu_actions)
+
         add_actions(self.main_toolbar, self.main_toolbar_actions)
         add_actions(self.file_toolbar, self.file_toolbar_actions)
         add_actions(self.edit_toolbar, self.edit_toolbar_actions)
diff --git a/spyderlib/plugins/externalconsole.py b/spyderlib/plugins/externalconsole.py
index 9b8ba50..391958a 100644
--- a/spyderlib/plugins/externalconsole.py
+++ b/spyderlib/plugins/externalconsole.py
@@ -1021,6 +1021,13 @@ class ExternalConsole(SpyderPluginWidget):
                             _(&quot;Open a &amp;Python console&quot;), None,
                             ima.icon(&#39;python&#39;),
                             triggered=self.open_interpreter)
+        misc_action = create_action(self,
+                            _(&quot;&amp;Do Something&quot;), None,
+                            ima.icon(&#39;python&#39;),
+                            triggered=self.misc_action)
+
+        self.misc_menu_actions = [misc_action]
+
         if os.name == &#39;nt&#39;:
             text = _(&quot;Open &amp;command prompt&quot;)
             tip = _(&quot;Open a Windows command prompt&quot;)
@@ -1180,6 +1187,12 @@ class ExternalConsole(SpyderPluginWidget):
         self.start(fname=None, wdir=to_text_string(wdir), args=&#39;&#39;,
                    interact=True, debug=False, python=True)

+    @Slot()
+    def misc_action(self):
+        &quot;&quot;&quot;Open interpreter&quot;&quot;&quot;
+        print(&quot;Hello World Action&quot;)
+
+
     def start_ipykernel(self, client, wdir=None, give_focus=True):
         &quot;&quot;&quot;Start new IPython kernel&quot;&quot;&quot;
         if not self.get_option(&#39;monitor/enabled&#39;):
</code></pre>
<p>And we can run <code>python3 bootstrap.py</code> and... it doesn't work! Out <code>Misc</code> menu still doesn't drop down any clickable actions when we click on it! It turns out we missed a few spots when trying to monkey the existing code and copied them badly:</p>
<pre><code class="diff">$ git --no-pager diff
diff --git a/spyderlib/plugins/externalconsole.py b/spyderlib/plugins/externalconsole.py
index 6e7c548..d169e48 100644
--- a/spyderlib/plugins/externalconsole.py
+++ b/spyderlib/plugins/externalconsole.py
@@ -1026,7 +1026,7 @@ class ExternalConsole(SpyderPluginWidget):
                             ima.icon(&#39;python&#39;),
                             triggered=self.misc_action)

-        self.misc_menu_actions = [misc_action]
+        self.main.misc_menu_actions = [misc_action]

         if os.name == &#39;nt&#39;:
             text = _(&quot;Open &amp;command prompt&quot;)
@@ -1048,7 +1048,7 @@ class ExternalConsole(SpyderPluginWidget):
         self.main.consoles_menu_actions += consoles_menu_actions
         self.main.tools_menu_actions += tools_menu_actions

-        return self.menu_actions+consoles_menu_actions+tools_menu_actions
+        return self.menu_actions+consoles_menu_actions+tools_menu_actions+[misc_action]

     def register_plugin(self):
         &quot;&quot;&quot;Register plugin in Spyder&#39;s main window&quot;&quot;&quot;
</code></pre>
<p>And it works!</p>
<p><div style="text-align: center"><img src="Diving/MenuAction.png" alt="Diving/MenuAction.png" style="max-width: 100%; max-height: 500px" /></div></p>
<p>And you can click on it, except... the print statement doesn't seem to be going anywhere. Or at least, it isn't turning up in the console, which still says</p>
<pre><code class="">$ python3 bootstrap.py
Executing Spyder from source checkout
Revision e978c9c, Branch: master
01. Patched sys.path with /Users/haoyi/test/spyder
02. PyQt4 is detected, selecting
03. Imported Spyder 3.0.0dev
    [Python 3.5.1 64bits, Qt 4.8.7, PyQt4 (API v2) 4.11.4 on Darwin]
04. Running Spyder
Bootstrap completed in 00:00:01.2533
</code></pre>
<p>Even after clicking the action. It's plausible that the Spyder IDE redirects print statements to some log file, but I don't see any in the repository tree. There is a <code>~/.spyder-py3</code> folder in my home directory, but again I don't see anything that looks like a log file:</p>
<pre><code class="">$ tree ~/.spyder-py3/
/Users/haoyi/.spyder-py3/
 db
  submodules
 defaults
  defaults-26.1.0.ini
 history.py
 history_internal.py
 langconfig
 onlinehelp
 spyder.ini
 spyder.ini.bak
 spyder.lock -&gt; 54811
 spyplugins
  __init__.py
  io
   __init__.py
  ui
      __init__.py
 temp.py
 template.py
 workingdir
</code></pre>
<p>One option that we could try to use to make sure our code is getting run is to write to a file instead of printing to stdout:</p>
<pre><code class="diff">$ git diff
diff --git a/spyderlib/plugins/externalconsole.py b/spyderlib/plugins/externalconsole.py
index 94fe765..6a7ca15 100644
--- a/spyderlib/plugins/externalconsole.py
+++ b/spyderlib/plugins/externalconsole.py
@@ -1191,7 +1191,8 @@ class ExternalConsole(SpyderPluginWidget):
     def misc_action(self):
         &quot;&quot;&quot;Open interpreter&quot;&quot;&quot;

-        print(&quot;Hello World Action&quot;)
+        with open(&quot;logfile.txt&quot;, &quot;w&quot;) as f:
+            f.write(&quot;Hello World misc_action&quot;)


     def start_ipykernel(self, client, wdir=None, give_focus=True):
</code></pre>
<p>but when I do so and click the <code>Do something</code> action, I still can't find any log file anywhere on my filesystem using <code>find / -name &quot;logfile.txt&quot;</code>. Does that mean our painstakingly crafted callback is not running? What if we copy the <code>open_interpreter</code> call word for word?</p>
<pre><code class="diff">$ git --no-pager diff
diff --git a/spyderlib/plugins/externalconsole.py b/spyderlib/plugins/externalconsole.py
index 94fe765..4041ac3 100644
--- a/spyderlib/plugins/externalconsole.py
+++ b/spyderlib/plugins/externalconsole.py
@@ -1187,12 +1187,13 @@ class ExternalConsole(SpyderPluginWidget):
         self.start(fname=None, wdir=to_text_string(wdir), args=&#39;&#39;,
                    interact=True, debug=False, python=True)

-    @Slot()
-    def misc_action(self):
-        &quot;&quot;&quot;Open interpreter&quot;&quot;&quot;
-
-        print(&quot;Hello World Action&quot;)
-
+    @Slot(str)
+    def misc_action(self, wdir=None):
+        &quot;&quot;&quot;Open terminal&quot;&quot;&quot;
+        if not wdir:
+            wdir = getcwd()
+        self.start(fname=None, wdir=to_text_string(wdir), args=&#39;&#39;,
+                   interact=True, debug=False, python=False)

     def start_ipykernel(self, client, wdir=None, give_focus=True):
         &quot;&quot;&quot;Start new IPython kernel&quot;&quot;&quot;
</code></pre>
<p>Sure enough, when you click <code>Do something</code> this opens up a new interpreter pane! What if I add a <code>print</code> statement <em>now</em>?</p>
<pre><code class="diff">$ git --no-pager diff
diff --git a/spyderlib/plugins/externalconsole.py b/spyderlib/plugins/externalconsole.py
index 4041ac3..374c04b 100644
--- a/spyderlib/plugins/externalconsole.py
+++ b/spyderlib/plugins/externalconsole.py
@@ -1192,6 +1192,7 @@ class ExternalConsole(SpyderPluginWidget):
         &quot;&quot;&quot;Open terminal&quot;&quot;&quot;
         if not wdir:
             wdir = getcwd()
+        print(&quot;HELLO WORLD misc_action&quot;)
         self.start(fname=None, wdir=to_text_string(wdir), args=&#39;&#39;,
                    interact=True, debug=False, python=False)
</code></pre>
<p>Now, <code>Do something</code> opens up a new interpreter pane, and <em>still does not print anything</em>. Presumably our code was running all along, but somehow <code>print</code> and file-output was being redirected by Spyder... somewhere. I'm not sure how we're going to debug things going forward, but at least we know our code works for now and is running!</p><h3 id="endgame-the-editor">Endgame: the Editor</h3>
<p>The last thing we need to do to accomplish our initial goal is to make modifications to the code editor. A cursory search through the filesystem reveals a file promisingly named <code>widgets/editor.py</code>:</p>
<pre><code class="python"># -*- coding: utf-8 -*-
#
# Copyright  2009- The Spyder Development Team
# Licensed under the terms of the MIT License
# (see spyderlib/__init__.py for details)

&quot;&quot;&quot;Editor Widget&quot;&quot;&quot;

# pylint: disable=C0103
# pylint: disable=R0903
# pylint: disable=R0911
# pylint: disable=R0201

from __future__ import print_function

from spyderlib.qt import is_pyqt46
from spyderlib.qt.QtGui import (QVBoxLayout, QMessageBox, QMenu, QFont,
                                QAction, QApplication, QWidget,
                                QKeySequence, QMainWindow, QSplitter,
                                QHBoxLayout)
...
</code></pre>
<p>With a promisingly-named <code>EditorWidget</code></p>
<pre><code class="python">class EditorWidget(QSplitter):
    def __init__(self, parent, plugin, menu_actions, show_fullpath,
                 fullpath_sorting, show_all_files, show_comments):
      ...
  ...
</code></pre>
<p>This most definitely contains the code being edited. The only question is where it gets created and how we can use it. </p>
<p>It seems to be constructed in <code>EditorMainWindow</code>:</p>
<pre><code class="python"><br/>class EditorMainWindow(QMainWindow):
    def __init__(self, plugin, menu_actions, toolbar_list, menu_list,
                 show_fullpath, fullpath_sorting, show_all_files,
                 show_comments):
        QMainWindow.__init__(self)
        self.setAttribute(Qt.WA_DeleteOnClose)

        self.window_size = None

        self.editorwidget = EditorWidget(self, plugin, menu_actions,
                                         show_fullpath, fullpath_sorting,
                                         show_all_files, show_comments)
</code></pre>
<p>Which is itself constructed in the body of <code>Editor</code>, in <code>plugins/Editor.py</code>:</p>
<pre><code class="python">class Editor(SpyderPluginWidget):
    &quot;&quot;&quot;
    Multi-file Editor widget
    &quot;&quot;&quot;
    CONF_SECTION = &#39;editor&#39;
    CONFIGWIDGET_CLASS = EditorConfigPage
    TEMPFILE_PATH = get_conf_path(&#39;temp.py&#39;)
    TEMPLATE_PATH = get_conf_path(&#39;template.py&#39;)
    DISABLE_ACTIONS_WHEN_HIDDEN = False # SpyderPluginWidget class attribute
    
    # Signals
    ...
    def create_new_window(self):
        oe_options = self.outlineexplorer.get_options()
        fullpath_sorting=self.get_option(&#39;fullpath_sorting&#39;, True),
        window = EditorMainWindow(self, self.stack_menu_actions,
                                  self.toolbar_list, self.menu_list,
                                  show_fullpath=oe_options[&#39;show_fullpath&#39;],
                                  fullpath_sorting=fullpath_sorting,
                                  show_all_files=oe_options[&#39;show_all_files&#39;],
                                  show_comments=oe_options[&#39;show_comments&#39;])
        window.resize(self.size())
        window.show()
        self.register_editorwindow(window)
        window.destroyed.connect(lambda: self.unregister_editorwindow(window))
        return window
</code></pre>
<p>Jumping around across files is much easier with a smart editor like PyCharm, but even without it searching for the name <code>EditorMainWindow</code> across the entire project using <code>grep</code> or <code>ack</code> or <code>ag</code> should find you what you want.</p>
<p>And <code>Editor</code>, itself, is found in <code>spyder.py</code> as part of the <code>MainWindow</code>'s <code>setup</code> method:</p>
<pre><code class="python">...

# Editor plugin
self.set_splash(_(&quot;Loading editor...&quot;))
from spyderlib.plugins.editor import Editor
self.editor = Editor(self)
self.editor.register_plugin()

# Populating file menu entries
quit_action = create_action(self, _(&quot;&amp;Quit&quot;),
                            icon=ima.icon(&#39;exit&#39;), 
                            tip=_(&quot;Quit&quot;),
                            triggered=self.console.quit)
self.register_shortcut(quit_action, &quot;_&quot;, &quot;Quit&quot;)
restart_action = create_action(self, _(&quot;&amp;Restart&quot;),
                                icon=ima.icon(&#39;restart&#39;),
                                tip=_(&quot;Restart&quot;),
                                triggered=self.restart)
...
</code></pre>
<p>Good. Now we know how to get from</p>
<ul>
  <li><code>MainWindow</code> to <code>Editor</code></li>
  <li><code>Editor</code> to <code>EditorMainWindow</code>, seemingly through <code>EditorStack</code> somehow</li>
  <li><code>EditorMainWindow</code> to <code>EditorWidget</code></li>
  <li><code>EditorWidget</code> to... where?</li>
</ul>
<p>It turns out that this path may be a bit of a red herring, since there is another class under <code>widgets/sourcecode/codeeditor.py</code> called <code>CodeEditor</code> that seems like it really does implement text-editor capabilities. </p>
<p>The <code>CodeEditor</code> class has a <code>set_text</code> method that seems to do exactly what we want:</p>
<pre><code class="python">def set_text(self, text):
        &quot;&quot;&quot;Set the text of the editor&quot;&quot;&quot;
        self.setPlainText(text)
        self.set_eol_chars(text)
        #if self.supported_language:
            #self.highlighter.rehighlight()

</code></pre>
<p>And it's superclass <code>TextEditBaseWidget</code> has a <code>toPlainText</code> method that also looks promising for getting the current text to modify:</p>
<pre><code class="python">def toPlainText(self):
    &quot;&quot;&quot;
    Reimplement Qt method
    Fix PyQt4 bug on Windows and Python 3
    &quot;&quot;&quot;
    # Fix what appears to be a PyQt4 bug when getting file
    # contents under Windows and PY3. This bug leads to
    # corruptions when saving files with certain combinations
    # of unicode chars on them (like the one attached on
    # Issue 1546)
    if os.name == &#39;nt&#39; and PY3:
        text = self.get_text(&#39;sof&#39;, &#39;eof&#39;)
        return text.replace(&#39;\u2028&#39;, &#39;\n&#39;).replace(&#39;\u2029&#39;, &#39;\n&#39;)\
                   .replace(&#39;\u0085&#39;, &#39;\n&#39;)
    else:
        return super(TextEditBaseWidget, self).toPlainText()

</code></pre>
<p>I have no idea what the doc-string is saying, or what all those weird unicode <code>.replace</code> calls are doing, or what the <code>super</code> version of <code>toPlainText</code> is doing. On the other hand if it can call <code>.replace</code> like that it's probably returning a Python <code>str</code>, which is what I want, and just from the name I'd guess it probably does what I want.</p>
<p>How does that relate to the editors we've already seen? It appears to be created in <code>EditorStack.create_new_editor</code>:</p>
<pre><code class="python">def create_new_editor(self, fname, enc, txt, set_current, new=False,
                      cloned_from=None):
    &quot;&quot;&quot;
    Create a new editor instance
    Returns finfo object (instead of editor as in previous releases)
    &quot;&quot;&quot;
    editor = codeeditor.CodeEditor(self)
    ...
</code></pre>
<p>Which is called in <code>EditorStack.new</code>, which is itself called in <code>Editor.new</code>. I'm not sure where these things finally get set as attributes I can use, but browsing around these few editor-related files I notice there's a <code>get_current_editor</code> method on <code>EditorStack</code> that does exactly what I want:</p>
<pre><code class="python">def get_current_editor(self):
    editorstack = self.get_current_editorstack()
    if editorstack is not None:
        return editorstack.get_current_editor()
</code></pre>
<p>I don't know what that implementation does, or where all those other methods are defined, but from the name it very-much-seems that it does exactly what I want and gives me the editor that the IDE is currently focused on. Without looking at the code it still might not - it could do anything! - but if it doesn't give me the currently focused window then whoever wrote that code and gave it this name would have to be a real jerk. Most programmers are usually nice people, so it probably does what I want.</p><h3 id="desperately-needing-to-debug">Desperately needing to Debug</h3>
<p>Now we know that we can <code>self.main.editor.get_current_editor()</code> inside <code>misc_action</code> to get the current editor; but <em>which</em> editor are we getting? From the name we don't really know, and possibilities include:</p>
<ul>
  <li><code>spyderlib.plugins.editor.Editor</code></li>
  <li><code>spyderlib.widgets.editor.EditorMainWindow</code></li>
  <li><code>spyderlib.widgets.editor.EditorStack</code></li>
  <li><code>spyderlib.widgets.editor.EditorWidget</code></li>
  <li><code>spyderlib.widgets.sourcecode.codeeditor.CodeEditor</code></li>
</ul>
<p>They all have the word "Editor" in them, and all are plausible return types from the <code>get_current_editor</code> method! How do we know which one we're getting, given that so far we haven't even managed to print a single thing from our <code>misc_action</code> method, even though we know it's running?</p>
<p>If this was Java or some other statically-typed language we'd know immediately what a method returns, but...</p>
<p><div style="text-align: center"><img src="Diving/ThisIsPython.jpg" alt="Diving/ThisIsPython.jpg" style="max-width: 100%; max-height: 500px" /></div></p>
<p>So we're left guessing in the dark.</p>
<p>It turns out that even though you can't print things or write things to files, there are other ways to get debugging output out of the <code>misc_action</code> method in order for you to figure out what is going on! One example is using the <code>QMessageBox.warning</code> method, that's in fact used in the method right below <code>misc_action</code>, <code>start_ipykernel</code>:</p>
<pre><code class="python">def start_ipykernel(self, client, wdir=None, give_focus=True):
    &quot;&quot;&quot;Start new IPython kernel&quot;&quot;&quot;
    if not self.get_option(&#39;monitor/enabled&#39;):
        QMessageBox.warning(self, _(&#39;Open an IPython console&#39;),
            _(&quot;The console monitor was disabled: the IPython kernel will &quot;
              &quot;be started as expected, but an IPython console will have &quot;
              &quot;to be connected manually to the kernel.&quot;), QMessageBox.Ok)
    
    if not wdir:
        wdir = getcwd()
    self.main.ipyconsole.visibility_changed(True)
    self.start(fname=None, wdir=to_text_string(wdir), args=&#39;&#39;,
               interact=True, debug=False, python=True, ipykernel=True,
               ipyclient=client, give_ipyclient_focus=give_focus)
</code></pre>
<p>We can make use of this in our <code>misc_action</code> method to help figure out what on earth is going on:</p>
<pre><code class="diff">$ git --no-pager diff
diff --git a/spyderlib/plugins/externalconsole.py b/spyderlib/plugins/externalconsole.py
index 4041ac3..1585abf 100644
--- a/spyderlib/plugins/externalconsole.py
+++ b/spyderlib/plugins/externalconsole.py
@@ -1192,6 +1192,9 @@ class ExternalConsole(SpyderPluginWidget):
         &quot;&quot;&quot;Open terminal&quot;&quot;&quot;
         if not wdir:
             wdir = getcwd()
+
+        QMessageBox.warning(self, _(&#39;Open an IPython console&#39;),
+                            _(str(type(self.main.editor.get_current_editor()))), QMessageBox.Ok)
         self.start(fname=None, wdir=to_text_string(wdir), args=&#39;&#39;,
                    interact=True, debug=False, python=False)
</code></pre>
<p>This should print out the type of the thing returned by <code>get_current_editor</code> when we select the action, which should hopefully tell us which of the 5 alternatives it is an what methods/properties we can call on it to do what we want.</p>
<p>And now clicking on <code>Do something</code> in the dropdown, we get results!</p>
<p><div style="text-align: center"><img src="Diving/Debugging.png" alt="Diving/Debugging.png" style="max-width: 100%; max-height: 500px" /></div></p>
<p>And from this, we can see that of all the possibilities, we know that <code>get_current_editor</code> returns a <code>spyderlib.widgets.sourcecode.codeeditor.CodeEditor</code> object, and none of the others. Or, since it's Python, we know that <em>this time</em> it returned a <code>CodeEditor</code> object, and other times it may return different things. On the other hand, the original programmer would have had to be a real jerk to make it return different types at different times, so we can for now assume he was a nice person and the return type won't change underneath us.</p>
<p>That means we can try calling <code>set_text</code> on it:</p>
<pre><code class="diff">$ git --no-pager diff
diff --git a/spyderlib/plugins/externalconsole.py b/spyderlib/plugins/externalconsole.py
index 4041ac3..4dfb85b 100644
--- a/spyderlib/plugins/externalconsole.py
+++ b/spyderlib/plugins/externalconsole.py
@@ -1192,6 +1192,7 @@ class ExternalConsole(SpyderPluginWidget):
         &quot;&quot;&quot;Open terminal&quot;&quot;&quot;
         if not wdir:
             wdir = getcwd()
+        self.main.editor.get_current_editor().set_text(&quot;fooooo&quot;)
         self.start(fname=None, wdir=to_text_string(wdir), args=&#39;&#39;,
                    interact=True, debug=False, python=False)
</code></pre>
<p>Which gives results:</p>
<p><div style="text-align: center"><img src="Diving/SetText.png" alt="Diving/SetText.png" style="max-width: 100%; max-height: 500px" /></div></p>
<p>And then trying <code>toPlainText</code>, together with the <code>spyderlib.plugins.editor.Editor</code>'s useful <code>get_current_filename()</code> method that I noticed earlier when digging through the 5 similar <code>Editor</code>-like classes:</p>
<pre><code class="diff">$ git --no-pager diff
diff --git a/spyderlib/plugins/externalconsole.py b/spyderlib/plugins/externalconsole.py
index 4041ac3..97cac71 100644
--- a/spyderlib/plugins/externalconsole.py
+++ b/spyderlib/plugins/externalconsole.py
@@ -1192,8 +1192,10 @@ class ExternalConsole(SpyderPluginWidget):
         &quot;&quot;&quot;Open terminal&quot;&quot;&quot;
         if not wdir:
             wdir = getcwd()
-        self.start(fname=None, wdir=to_text_string(wdir), args=&#39;&#39;,
-                   interact=True, debug=False, python=False)
+        self.main.editor.get_current_editor().set_text(
+            (&quot;print(&#39;Running %s&#39;)\n&quot; % self.main.editor.get_current_filename()) +
+            self.main.editor.get_current_editor().toPlainText()
+        )

     def start_ipykernel(self, client, wdir=None, give_focus=True):
         &quot;&quot;&quot;Start new IPython kernel&quot;&quot;&quot;
</code></pre>
<p>And, 5 hours after we initially started trying to install things, it finally works!</p>
<p><div style="text-align: center"><img src="Diving/Works.png" alt="Diving/Works.png" style="max-width: 100%; max-height: 500px" /></div></p>
<p>Here's the final diff from branching off the github <code>master</code> branch at time of writing, commit <code>df9577cfc279d2b6f2c07c7ba4e8e7aebfdd1835</code>:</p>
<pre><code class="diff">$ git --no-pager diff
diff --git a/spyderlib/plugins/externalconsole.py b/spyderlib/plugins/externalconsole.py
index 4041ac3..97cac71 100644
--- a/spyderlib/plugins/externalconsole.py
+++ b/spyderlib/plugins/externalconsole.py
@@ -1192,8 +1192,10 @@ class ExternalConsole(SpyderPluginWidget):
         &quot;&quot;&quot;Open terminal&quot;&quot;&quot;
         if not wdir:
             wdir = getcwd()
-        self.start(fname=None, wdir=to_text_string(wdir), args=&#39;&#39;,
-                   interact=True, debug=False, python=False)
+        self.main.editor.get_current_editor().set_text(
+            (&quot;print(&#39;Running %s&#39;)\n&quot; % self.main.editor.get_current_filename()) +
+            self.main.editor.get_current_editor().toPlainText()
+        )

     def start_ipykernel(self, client, wdir=None, give_focus=True):
         &quot;&quot;&quot;Start new IPython kernel&quot;&quot;&quot;
$ git --no-pager diff df9577cfc279d2b6f2c07c7ba4e8e7aebfdd1835
diff --git a/spyderlib/app/spyder.py b/spyderlib/app/spyder.py
index 6d9763f..4ed17a2 100644
--- a/spyderlib/app/spyder.py
+++ b/spyderlib/app/spyder.py
@@ -408,6 +408,9 @@ class MainWindow(QMainWindow):
         self.toolbars_menu = None
         self.help_menu = None
         self.help_menu_actions = []
+        self.misc_menu = None
+        self.misc_menu_actions = []
+

         # Status bar widgets
         self.mem_status = None
@@ -663,6 +666,9 @@ class MainWindow(QMainWindow):
         # Help menu
         self.help_menu = self.menuBar().addMenu(_(&quot;&amp;Help&quot;))

+        # Misc menu
+        self.misc_menu = self.menuBar().addMenu(_(&quot;&amp;Misc&quot;))
+
         # Status bar
         status = self.statusBar()
         status.setObjectName(&quot;StatusBar&quot;)
@@ -1181,6 +1187,8 @@ class MainWindow(QMainWindow):
                     self.external_tools_menu_actions)
         add_actions(self.help_menu, self.help_menu_actions)

+        add_actions(self.misc_menu, self.misc_menu_actions)
+
         add_actions(self.main_toolbar, self.main_toolbar_actions)
         add_actions(self.file_toolbar, self.file_toolbar_actions)
         add_actions(self.edit_toolbar, self.edit_toolbar_actions)
diff --git a/spyderlib/plugins/externalconsole.py b/spyderlib/plugins/externalconsole.py
index 9b8ba50..97cac71 100644
--- a/spyderlib/plugins/externalconsole.py
+++ b/spyderlib/plugins/externalconsole.py
@@ -1021,6 +1021,13 @@ class ExternalConsole(SpyderPluginWidget):
                             _(&quot;Open a &amp;Python console&quot;), None,
                             ima.icon(&#39;python&#39;),
                             triggered=self.open_interpreter)
+        misc_action = create_action(self,
+                            _(&quot;&amp;Do Something&quot;), None,
+                            ima.icon(&#39;python&#39;),
+                            triggered=self.misc_action)
+
+        self.main.misc_menu_actions = [misc_action]
+
         if os.name == &#39;nt&#39;:
             text = _(&quot;Open &amp;command prompt&quot;)
             tip = _(&quot;Open a Windows command prompt&quot;)
@@ -1041,7 +1048,7 @@ class ExternalConsole(SpyderPluginWidget):
         self.main.consoles_menu_actions += consoles_menu_actions
         self.main.tools_menu_actions += tools_menu_actions

-        return self.menu_actions+consoles_menu_actions+tools_menu_actions
+        return self.menu_actions+consoles_menu_actions+tools_menu_actions+[misc_action ]

     def register_plugin(self):
         &quot;&quot;&quot;Register plugin in Spyder&#39;s main window&quot;&quot;&quot;
@@ -1180,6 +1187,16 @@ class ExternalConsole(SpyderPluginWidget):
         self.start(fname=None, wdir=to_text_string(wdir), args=&#39;&#39;,
                    interact=True, debug=False, python=True)

+    @Slot(str)
+    def misc_action(self, wdir=None):
+        &quot;&quot;&quot;Open terminal&quot;&quot;&quot;
+        if not wdir:
+            wdir = getcwd()
+        self.main.editor.get_current_editor().set_text(
+            (&quot;print(&#39;Running %s&#39;)\n&quot; % self.main.editor.get_current_filename()) +
+            self.main.editor.get_current_editor().toPlainText()
+        )
+
     def start_ipykernel(self, client, wdir=None, give_focus=True):
         &quot;&quot;&quot;Start new IPython kernel&quot;&quot;&quot;
         if not self.get_option(&#39;monitor/enabled&#39;):
</code></pre><h2 id="conclusion">Conclusion</h2>
<p>We're not nearly "done", from the point of view of making a serious contribution. While we've demonstrated a patch that works, with changes we <em>could</em> do, it's another thing entirely to understand the underlying codebase enough to know what changes we <em>should</em> do and <em>how</em> to do them. For example, dumping the <code>misc__action</code> command in <code>externalconsole.py</code> works, but it definitely isn't the right thing to do, and would never make it past code review! </p>
<p>Nonetheless, this would get us to the start of the code-review process in a professional setting. We have gotten enough understanding of the overall architecture of the codebase to have intelligent discussions about how our changes would fit into the wider codebase, as well as working (if rough) patch we can use as a base for polish and tidying-up on. Not a bad result for 5 hours of investment!</p>
<p>We've made it pretty far in wrestling with, understanding, and making progress against a large, existing codebase from a starting point of total ignorance. Here are some interesting lessons learned:</p>
<ul>
  <li>
  <p><strong>Installation is a pain and that's ok</strong>. It took me two hours to get Spyder  working on my laptop. That's enough time to get frustrated, but not a lot of  time in the grand scheme of things. Have the professionalism to willingly  sacrifice quantities of time without frustration or unhappiness. Your time  and effort is a resource like any other, and directing the fire-hose of your  effort into conquering a borked setup process is just another task of many  tasks you will overcome in your career.</p></li>
  <li>
  <p><strong>You do not need to understand everything</strong>. In fact, you do not need to  understand most things, at least initially. There are too many things for  you to understand all at once. You will be working with partial understanding  of the codebase and that is totally ok. Later on you can take another pass,  after you get things "working", to really-truly understand what is going on.</p></li>
  <li>
  <p><strong>Your methods for understanding are messy and ad-hoc</strong>. You are not going to  be writing mathematical proofs about a new codebase. Instead, you are  searching for keywords, browsing the filesystem, jumping around from one  clue to the next. You should be working in theories, clues, hints, and  suspicions during this period of unfamiliarity: we ain't got no time for a  systematic search for what you want.</p></li>
  <li>
  <p><strong>Unrelated experience is important</strong>. When you don't understand what on earth  is going on, you rely on your experience with similar problems in the past in  order to make snap decisions or judgements. For example, experience says the  text at the top of the window is called a <em>title</em>. Experience says I can  install odd things things using <code>brew install</code>. Experience tells me that  <em>somewhere</em> in the codebase, there will be methods to <code>get_text</code> and  <code>set_text</code> the text editor's contents, even though I've never seen this  codebase before in my life. Having dealt with similar problems elsewhere,  it makes the ad-hoc search and guesses much more accurate.</p></li>
  <li>
  <p><strong>The codebase you will be working with is messy and ad-hoc</strong>. Why are there  5-6 different classes all of which are called some variant of <code>Editor</code>, that  are all intricately related to each other in subtle ways? Why is the  functionality commonly related to "editors" like text content, cursors and  selection split throughout all of them, and mixed with other distinctly  non-editor-related things? Could some of them have been named better? Have  better docstrings? Definitely. Will they? Probably not in any real-world  codebase I've seen. That's life.</p></li>
  <li>
  <p><strong>Verify everything</strong>. <em>"My code is correct"</em> needs verification. <em>"My code is  running"</em> needs verification. <em>"My code isn't crashing and having its errors  silently swallowed"</em> needs verification. <em>"The changes I'm making to these  files are making it into the running application and aren't being ignored"</em>  needs verification. <em>"When I print something, it turns up in the console"</em>  needs verification, and in this case was false! Take baby steps and don't  make massive changes without verifying these basics. You are unfamiliar with  the codebase: there will be countless things that don't behave as you'd  expect. </p></li>
  <li>
  <p><strong>You don't learn this skill in school, but you can learn it</strong>. Diving into  unfamiliar code is not a talent: it is a skill, and can be trained like any  other. Designing algorithms and systems, writing working code to get things  done, diving into other people's code, wrestling with baroque and obnoxious  dependencies, these are just a few facets of being a professional software  engineer.</p></li>
</ul>
<p>And that's how you dive into other people's code you've never seen before, and make non-trivial changes to it while working in a state of half-ignorance for a few hours. Feel free to post your own stories, tricks or techniques in the comments below! </p><div><hr /><div style="color: rgb(158, 167, 174);">Updated <a href="https://github.com/lihaoyi/blog/commit/95c7d7d5d42829dbf0f83e203f2806ecb883e520">2016-03-15 </a><a href="https://github.com/lihaoyi/blog/commit/7da069c18955e1db8f0c5a15f9469eed926126ae">2016-03-15 </a><a href="https://github.com/lihaoyi/blog/commit/cc42e0f9be957ceffd2e88ea77d98d8be805d752">2016-03-15 </a></div></div><div id="disqus_thread"></div><script>
      /**
      * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
      * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
      */

      var disqus_config = function () {
      this.page.url = "http://www.lihaoyi.com/post/DivingIntoOtherPeoplesCode.html"; // Replace PAGE_URL with your page's canonical URL variable
      this.page.identifier = "Diving Into Other People's Code"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
      };

      (function() { // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');

      s.src = '//lihaoyi.disqus.com/embed.js';

      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
      })();
  </script></div><div class=" ammonite-scripts-pageStyles_3-WideStyles-footer ammonite-scripts-pageStyles_3-Styles-footer">Last published 2016-07-02</div></body></html>